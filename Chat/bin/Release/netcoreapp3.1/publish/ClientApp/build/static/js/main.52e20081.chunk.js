(this["webpackJsonpazure-communication-services-chat-sample"]=this["webpackJsonpazure-communication-services-chat-sample"]||[]).push([[0],{1040:function(e,t,n){},1044:function(e,t,n){"use strict";n.r(t);var r=n(413),a=n(103),i=n(410),c=n(215),o=n(216),s=n(245),l=n(0),u=n.n(l),d=n(60),m=n.n(d),h=n(20),p=n(15),f=n(1170),g=n(35),v=n(125),b=n(415),E=n(1180),O=n(11),S=n(1174),j=n(1162),I=n(1181),y=n(1059),w=n(107),D=n(412),C=n(365),x=n(298),k=/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*)/,N=/^\s*$/,T=n(3),R=n.n(T),P=n(14),A=n(416),M=function(e){switch(e){case"\ud83d\udc31":return{backgroundColor:"rgba(255, 250, 228, 1)"};case"\ud83d\udc2d":return{backgroundColor:"rgba(33, 131, 196, 0.1)"};case"\ud83d\udc28":return{backgroundColor:"rgba(197, 179, 173, 0.3)"};case"\ud83d\udc19":return{backgroundColor:"rgba(255, 240, 245, 1)"};case"\ud83d\udc35":return{backgroundColor:"rgba(255, 245, 222, 1)"};case"\ud83e\udd8a":return{backgroundColor:"rgba(255, 231, 205, 1)"};default:return{backgroundColor:"rgba(255, 250, 228, 1)"}}},L=function(){var e=new URLSearchParams(window.location.search);return console.log(e.get("threadId")),e.get("threadId")};var _=function(e,t){return void 0===e.createdOn?1:void 0===t.createdOn?-1:new Date(e.createdOn).getTime()-new Date(t.createdOn).getTime()},z=function(e,t){return Object(A.b)(e)&&e.communicationUserId===t},V=function(e,t){var n;return{content:{message:null===(n=e.content)||void 0===n?void 0:n.message},clientMessageId:t,sender:e.sender,senderDisplayName:e.senderDisplayName,createdOn:e.createdOn,id:e.id}},U=function(e,t,n,r){return{content:{message:r},clientMessageId:n,sender:{communicationUserId:e,kind:"communicationUser"},senderDisplayName:t,createdOn:new Date}},W={getAppServiceUrl:function(){return window.location.origin},getTokenForUser:function(){var e=Object(P.a)(R.a.mark((function e(){var t;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/token");case 2:if(!(t=e.sent).ok){e.next=5;break}return e.abrupt("return",t.json());case 5:throw new Error("Invalid token response");case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getRefreshedTokenForUser:function(){var e=Object(P.a)(R.a.mark((function e(t){var n,r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/refreshToken/".concat(t));case 2:if(!(n=e.sent).ok){e.next=8;break}return e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",r.token);case 8:throw new Error("Invalid token response");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),isSelectedAudioDeviceInList:function(e,t){return t.filter((function(t){return t.name===e.name})).length>0},isSelectedVideoDeviceInList:function(e,t){return t.filter((function(t){return t.name===e.name})).length>0},isMobileSession:function(){return!!window.navigator.userAgent.match(/(iPad|iPhone|iPod|Android|webOS|BlackBerry|Windows Phone)/g)},isSmallScreen:function(){return window.innerWidth<700||window.innerHeight<400},isUnsupportedBrowser:function(){return!!window.navigator.userAgent.match(/(Firefox)/g)},getId:function(e){switch(e.kind){case"communicationUser":return e.communicationUserId;case"phoneNumber":return e.phoneNumber;case"microsoftTeamsUser":return e.microsoftTeamsUserId;case"unknown":return e.id}},getStreamId:function(e,t){return"".concat(e,"-").concat(t.id,"-").concat(t.mediaStreamType)},isOnIphoneAndNotSafari:function(){var e=navigator.userAgent;return!(!e.includes("iPhone")||!e.includes("FxiOS")&&!e.includes("CriOS"))},getBuildTime:function(){return"10/7/2021, 7:52:16 pm"}},F=function(e){var t;return Object(p.D)({width:"2rem",minWidth:"2rem",height:"2rem",backgroundColor:null===(t=M(e))||void 0===t?void 0:t.backgroundColor,borderRadius:"50%",alignItems:"center",display:"flex",justifyContent:"center",fontFamily:"Segoe UI Regular",fontSize:"1rem"})},H=Object(p.D)({height:"100%",width:"100%",maxHeight:"100%",overflow:"auto"}),G=Object(p.D)({width:"1rem"}),B={backgroundColor:"white",border:"none",overflow:"auto",height:"100%"},Y=function(e){return Object(p.D)({marginLeft:e?"1rem":"0rem"})},K=Object(p.D)({float:"right",width:"fit-content"}),J=Object(p.D)({minHeight:"1.5rem"}),Z=Object(p.D)({marginRight:"0.5em"}),Q=Object(l.createRef)(),X=Object(l.createRef)(),$=n(48),q=n(115),ee=n(188),te=function(e){return{type:"SET_CHAT_CLIENT",chatClient:e}},ne=function(e,t,n){return{type:"SET_CURRENT_USER",identity:e,token:t,displayName:n}},re=function(e){return{type:"SET_USERS",users:e}},ae=function(e){return{type:"SET_RECEIPTS",receipts:e}},ie=function(e){return{type:"SET_MESSAGES",messages:e}},ce=function(e,t){return{type:"SET_TYPING_NOTIFICATIONS",id:e,typingNotification:t}},oe=function(e){return{type:"SET_TYPING_USERS",typingUsers:e}},se=function(e){return{type:"SET_FAILED_MESSAGES",failedMessages:e}},le=function(e){return{type:"SET_THREAD_TOPIC_NAME",topicName:e}},ue=function(e){return{type:"SET_THREAD_ID",threadId:e}},de=function(e){return{type:"SET_THREAD_MEMBERS",threadMembers:e}},me=function(e){return{type:"SET_THREAD_MEMBERS_ERROR",error:e}},he=n(1169),pe=n(1178),fe=n(74),ge=function(e){return{type:"SET_CALL_AGENT",callAgent:e}},ve=function(e){return{type:"CALL_ADDED",call:e}},be=function(e,t){return{type:"CALL_REMOVED",call:void 0,incomingCallEndReason:"Incoming"===e.direction?e.callEndReason:void 0,groupCallEndReason:"Incoming"!==e.direction&&t?e.callEndReason:void 0}},Ee=function(e){return{type:"SET_CALL_STATE",callState:e}},Oe=function(e){return{type:"SET_PARTICIPANTS",remoteParticipants:e}},Se=function(e){return{type:"SET_DOMINANT_PARTICIPANTS",dominantParticipants:e}},je=function(e){return{type:"SET_MIC",mic:e}},Ie=function(e){return{type:"SET_SHARE_SCREEN",shareScreen:e}},ye=function(e){return{type:"SET_DEVICE_MANAGER",deviceManager:e}},we=function(e){return{type:"SET_MICROPHONE_PERMISSION",microphonePermission:e}},De=function(e){return{type:"SET_CAMERA_PERMISSION",cameraPermission:e}},Ce=function(e){return{type:"SET_AUDIO_DEVICE_INFO",audioDeviceInfo:e}},xe=function(e){return{type:"SET_VIDEO_DEVICE_INFO",videoDeviceInfo:e}},ke=function(e){return{type:"SET_AUDIO_DEVICE_LIST",audioDeviceList:e}},Ne=function(e){return{type:"SET_VIDEO_DEVICE_LIST",videoDeviceList:e}},Te=function(e,t){return{type:"ADD_SCREENSHARE_STREAM",stream:e,user:t}},Re=n(128),Pe=n(28),Ae=n(43),Me=function(){function e(t,n){Object(Pe.a)(this,e),this.participantId=void 0,this.timeStamp=void 0,this.isUnMuted=!1,this.participantId=t,this.isUnMuted=n,this.timeStamp=Date.now()}return Object(Ae.a)(e,[{key:"process",value:function(e){this.isUnMuted&&!e.isUnMuted&&(e.lastUnMuted=this.timeStamp),e.isUnMuted=this.isUnMuted}}]),e}(),Le=function(){function e(t,n){Object(Pe.a)(this,e),this.participantId=void 0,this.timeStamp=void 0,this.isVideoOn=!1,this.participantId=t,this.isVideoOn=n,this.timeStamp=Date.now()}return Object(Ae.a)(e,[{key:"process",value:function(e){e.isVideoOn=this.isVideoOn}}]),e}(),_e=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(Pe.a)(this,e),this.isVideoOn=void 0,this.isUnMuted=void 0,this.lastUnMuted=void 0,this.participantId=void 0,this.displayName=void 0,this.participantId=t,this.displayName=n,this.isUnMuted=r,this.isVideoOn=a,this.lastUnMuted=-1},ze=function e(t,n){var r=this;Object(Pe.a)(this,e),this.dominantParticipantsCount=void 0,this.dipatch=void 0,this.batchedCommands=void 0,this.remoteParticipants=void 0,this.compareFn=function(e,t){return e.isVideoOn===t.isVideoOn?e.isUnMuted===t.isUnMuted?t.lastUnMuted-e.lastUnMuted:e.isUnMuted?-1:1:e.isVideoOn?-1:1},this.processCommands=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.batchedCommands;e.forEach((function(e){var t=r.remoteParticipants.get(e.participantId);t?e.process(t):console.error("RemoteStreamSelector: Participant ".concat(e.participantId," not found"))})),r.batchedCommands=[];var t=Object($.a)(r.remoteParticipants.values()).sort(r.compareFn);console.log("RemoteStreamSelector: Participants sorted list",t),r.dipatch(Se(t.slice(0,r.dominantParticipantsCount)))},this.participantAudioChanged=function(e,t){r.batchedCommands.push(new Me(e,t))},this.participantVideoChanged=function(e,t){r.batchedCommands.push(new Le(e,t))},this.participantStateChanged=function(e,t,n,a,i){switch(n){case"Connecting":r.remoteParticipants.set(e,new _e(e,t,a,i));break;case"Connected":r.remoteParticipants.set(e,new _e(e,t,a,i)),r.participantAudioChanged(e,a),r.participantVideoChanged(e,i);break;case"Disconnected":r.remoteParticipants.delete(e),r.processCommands()}},this.dominantParticipantsCount=t,this.dipatch=n,this.batchedCommands=[],this.remoteParticipants=new Map,setInterval((function(){return r.batchedCommands.length>0&&r.processCommands()}),e.ProcessingDelayInSeconds)};ze.ProcessingDelayInSeconds=2e3,ze.Singleton=void 0,ze.getInstance=function(e,t){var n;return ze.Singleton=null!==(n=ze.Singleton)&&void 0!==n?n:new ze(e,t)};var Ve=function e(){Object(Pe.a)(this,e)};Ve.INCOMING="Incoming",Ve.RINGING="Ringing",Ve.CONNECTING="Connecting",Ve.CONNECTED="Connected",Ve.DEFAULT_IMG_WIDTH=200,Ve.CROP_MEDIA="Crop",Ve.CONFIGURATION_LOCAL_VIDEO_PREVIEW_ID="ConfigurationLocalVideoPreview",Ve.LOCAL_VIDEO_PREVIEW_ID="LocalVideoPreview",Ve.MINI_HEADER_WINDOW_WIDTH=360,Ve.DOMINANT_PARTICIPANTS_COUNT=1;var Ue,We=function(e){return{type:"SET_USERID",userId:e}},Fe=function(e){return{type:"SET_CALL_CLIENT",callClient:e}},He=function(e,t){return function(){var n=Object(P.a)(R.a.mark((function n(r,a){var i,c,o,s,l,u,d,m,h;return R.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(i=a()).thread.threadId){n.next=4;break}return console.error("Thread Id not created yet"),n.abrupt("return");case 4:return c=i.thread.threadId,n.next=7,lt();case 7:if(void 0!==(o=n.sent)){n.next=11;break}return console.error("unable to get environment url from server"),n.abrupt("return");case 11:return n.next=13,ut();case 13:if(void 0!==(s=n.sent)){n.next=17;break}return console.error("unable to get a token"),n.abrupt("return");case 17:return l=s.user,u={token:s.token,tokenRefresher:function(){return dt(l.communicationUserId)},refreshProactively:!0},d=new pe.a(u),m=new he.a(o,d),mt(l.communicationUserId,t),n.next=24,m.getChatThreadClient(c);case 24:return h=n.sent,Be(m,r,a),Ge(m,r),Ye(m,h,r),Ke(m,l.communicationUserId,r,a),Je(m,r,a),r(ue(c)),r(ne(l.communicationUserId,s.token,e)),r(te(m)),n.next=35,at(c,{identity:l.communicationUserId,token:s.token,displayName:e,memberRole:"User"},r);case 35:return n.next=37,et(m,r,a);case 37:return n.next=39,Xe(m,r,a);case 39:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},Ge=function(){var e=Object(P.a)(R.a.mark((function e(t,n){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startRealtimeNotifications();case 2:t.on("typingIndicatorReceived",function(){var e=Object(P.a)(R.a.mark((function e(t){var r,a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.sender.communicationUserId,a={from:r,originalArrivalTime:t.receivedOn,recipientId:t.recipient.communicationUserId,threadId:t.threadId,version:t.version},n(ce(r,a));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Be=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startRealtimeNotifications();case 2:t.on("chatMessageReceived",function(){var e=Object(P.a)(R.a.mark((function e(t){var a,i,c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=r(),i=void 0!==a.chat.messages?a.chat.messages:[],z(t.sender,a.contosoClient.user.identity)||(c={sender:t.sender,id:t.id,senderDisplayName:t.senderDisplayName,createdOn:t.createdOn,content:{message:t.message}},i.push(c),n(ie(i.sort(_))));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ye=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.startRealtimeNotifications();case 2:t.on("readReceiptReceived",function(){var e=Object(P.a)(R.a.mark((function e(t){var a,i,c,o,s,l,u,d,m,h,p;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],i=!0,c=!1,e.prev=3,s=Object(ee.a)(n.listReadReceipts().byPage());case 5:return e.next=7,s.next();case 7:return l=e.sent,i=l.done,e.next=11,l.value;case 11:if(u=e.sent,i){e.next=19;break}d=u,m=Object(q.a)(d);try{for(m.s();!(h=m.n()).done;)p=h.value,a.push(p)}catch(t){m.e(t)}finally{m.f()}case 16:i=!0,e.next=5;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(3),c=!0,o=e.t0;case 25:if(e.prev=25,e.prev=26,i||null==s.return){e.next=30;break}return e.next=30,s.return();case 30:if(e.prev=30,!c){e.next=33;break}throw o;case 33:return e.finish(30);case 34:return e.finish(25);case 35:r(ae(a));case 36:case"end":return e.stop()}}),e,null,[[3,21,25,35],[26,,30,34]])})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ke=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r,a){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.on("participantsRemoved",function(){var e=Object(P.a)(R.a.mark((function e(t){var i,c,o,s,l,u,d,m;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a(),c=[],o=Object(q.a)(t.participantsRemoved),e.prev=3,o.s();case 5:if((s=o.n()).done){e.next=12;break}if(l=s.value,!z(l.id,n)){e.next=10;break}return r({type:"SET_REMOVED_FROM_THREAD",isRemoved:!0}),e.abrupt("return");case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),o.e(e.t0);case 17:return e.prev=17,o.f(),e.finish(17);case 20:for(u=i.threadMembers.threadMembers,d=function(){var e=u[m].id.communicationUserId;0===t.participantsRemoved.filter((function(t){return z(t.id,e)})).length&&c.push(u[m])},m=0;m<u.length;m++)d();r(de(c));case 24:case"end":return e.stop()}}),e,null,[[3,14,17,20]])})));return function(t){return e.apply(this,arguments)}}()),t.on("participantsAdded",function(){var e=Object(P.a)(R.a.mark((function e(t){var n,i,c,o,s,l,u,d,m,h;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=a(),i=Object($.a)(n.threadMembers.threadMembers),c=t.participantsAdded.map((function(e){return{id:e.id,displayName:e.displayName,shareHistoryTime:new Date((null===e||void 0===e?void 0:e.shareHistoryTime)||new Date)}})),o=function(){var e=t.participantsAdded[s],n=e.id.communicationUserId;0===i.filter((function(e){return z(e.id,n)})).length&&i.push(e)},s=0;s<t.participantsAdded.length;s++)o();l=Object.assign({},n.contosoClient.users),u=0;case 7:if(!(u<c.length)){e.next=19;break}if(d=c[u],m=d.id.communicationUserId,null!=l[m]){e.next=16;break}return e.next=14,ht(m);case 14:void 0!==(h=e.sent)&&(l[m]={emoji:h.emoji});case 16:u++,e.next=7;break;case 19:r(re(l)),r(de(i));case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Je=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.on("chatThreadPropertiesUpdated",function(){var e=Object(P.a)(R.a.mark((function e(t){var a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r(),a.thread.threadId){e.next=5;break}return console.error("no threadId set"),e.abrupt("return");case 5:n(le(t.properties.topic));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ze=function(e){return(new Date).getTime()-e<=8e3},Qe=function(e){return function(){var t=Object(P.a)(R.a.mark((function t(n){var r;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r={method:"GET"},t.next=4,fetch("/isValidThread/"+e,r);case 4:if(200!==t.sent.status){t.next=10;break}return n(ue(e)),t.abrupt("return",!0);case 10:return t.abrupt("return",!1);case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),console.error("Failed at getting isThreadIdValid, Error: ",t.t0);case 16:case"end":return t.stop()}}),t,null,[[0,13]])})));return function(e){return t.apply(this,arguments)}}()},Xe=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){var a,i,c,o;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r(),void 0!==t){e.next=4;break}return console.error("Chat Client not created yet"),e.abrupt("return");case 4:if(void 0!==(i=a.thread.threadId)){e.next=8;break}return console.error("Thread Id not created yet"),e.abrupt("return");case 8:return e.t0=ot,e.next=11,t.getChatThreadClient(i);case 11:return e.t1=e.sent,e.next=14,(0,e.t0)(e.t1);case 14:if(void 0!==(c=e.sent)){e.next=18;break}return console.error("unable to get messages"),e.abrupt("return");case 18:return o=c.map((function(e){return V(e)})).reverse(),e.abrupt("return",n(ie(o)));case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),$e=function(){var e=Object(P.a)(R.a.mark((function e(){var t;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt();case 2:null!==(t=e.sent)?window.location.href+="?threadId=".concat(t):console.error("unable to generate a new chat thread");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),qe=function(e){return function(){var t=Object(P.a)(R.a.mark((function t(n,r){var a,i,c,o;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r(),i=a.contosoClient.chatClient,c=a.thread.threadId,void 0!==i){t.next=6;break}return console.error("Chat client doesn't created yet"),t.abrupt("return");case 6:if(void 0!==c){t.next=9;break}return console.error("Thread Id not created yet"),t.abrupt("return");case 9:return t.next=11,i.getChatThreadClient(c);case 11:return o=t.sent,t.prev=12,t.next=15,o.removeParticipant({communicationUserId:e});case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(12),console.log(t.t0);case 20:case"end":return t.stop()}}),t,null,[[12,17]])})));return function(e,n){return t.apply(this,arguments)}}()},et=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){var a,i,c,o,s,l,u,d,m,h,p,f,g,v,b,E,O,S,j,I,y,w,D;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r(),void 0!==t){e.next=4;break}return console.error("Chat Client not created yet"),e.abrupt("return");case 4:if(void 0!==(c=i.thread.threadId)){e.next=8;break}return console.error("Thread Id not created yet"),e.abrupt("return");case 8:try{o=t.getChatThreadClient(c),s=o.listParticipants()}catch(C){console.error(C),n(me(!0))}if(l=[],s){e.next=13;break}return console.error("unable to resolve chat participant iterator"),e.abrupt("return");case 13:u=!0,d=!1,e.prev=15,h=Object(ee.a)(s.byPage());case 17:return e.next=19,h.next();case 19:return p=e.sent,u=p.done,e.next=23,p.value;case 23:if(f=e.sent,u){e.next=31;break}g=f,v=Object(q.a)(g);try{for(v.s();!(b=v.n()).done;)E=b.value,l.push(E)}catch(x){v.e(x)}finally{v.f()}case 28:u=!0,e.next=17;break;case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(15),d=!0,m=e.t0;case 37:if(e.prev=37,e.prev=38,u||null==h.return){e.next=42;break}return e.next=42,h.return();case 42:if(e.prev=42,!d){e.next=45;break}throw m;case 45:return e.finish(42);case 46:return e.finish(37);case 47:if(0!==l.length){e.next=50;break}return console.error("unable to get members in the thread"),e.abrupt("return");case 50:O=l.filter((function(e){return void 0!==e.displayName&&void 0!==e.id})),S=i.contosoClient.users,j=0;case 53:if(!(j<l.length)){e.next=65;break}if(I=l[j],y=I.id.communicationUserId,null!=S[y]){e.next=62;break}return e.next=60,ht(y);case 60:void 0!==(w=e.sent)&&(S[y]={emoji:w.emoji});case 62:j++,e.next=53;break;case 65:return e.next=67,null===(a=o)||void 0===a?void 0:a.getProperties();case 67:if(D=e.sent){e.next=71;break}return console.error("no chat thread properties"),e.abrupt("return");case 71:n(ue(c)),n(le(D.topic)),n(re(S)),n(de(O));case 75:case"end":return e.stop()}}),e,null,[[15,33,37,47],[38,,42,46]])})));return function(t,n,r){return e.apply(this,arguments)}}(),tt=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r,a){var i;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getChatThreadClient(n);case 2:i=e.sent,rt(i,r,a);case 4:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),nt=function(){var e=Object(P.a)(R.a.mark((function e(){var t,n,r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"POST"},e.next=4,fetch("/createThread",t);case 4:return n=e.sent,e.next=7,n.text();case 7:return r=e.sent,e.abrupt("return",r);case 11:e.prev=11,e.t0=e.catch(0),console.error("Failed at creating thread, Error: ",e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),rt=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.updateTopic(n);case 3:r(!1),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Failed at updating thread property, Error: ",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n,r){return e.apply(this,arguments)}}(),at=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){var a,i;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={id:n.identity,displayName:n.displayName},i={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},e.next=5,fetch("/addUser/"+t,i);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed at adding thread member, Error: ",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),it=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r,a,i,c){var o,s,l,u;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.sendMessage({content:n},{senderDisplayName:r});case 3:return o=e.sent,e.next=6,t.getMessage(o.id);case 6:s=e.sent,ct(i,c,V(s,a)),e.next=19;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("Failed at getting messages, Error: ",e.t0),(l=c().chat.failedMessages).push(a),se(l),(u=c().chat.messages.filter((function(e){return e.clientMessageId===a}))[0]).failed=!0,ct(i,c,u);case 19:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r,a,i,c){return e.apply(this,arguments)}}(),ct=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){var a,i;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n(),i=(i=void 0!==a.chat.messages?a.chat.messages:[]).map((function(e){return e.clientMessageId===r.clientMessageId?Object.assign({},e,r):e})),t(ie(i.sort(_)));case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ot=function(){var e=Object(P.a)(R.a.mark((function e(t){var n,r,a,i,c,o,s,l,u,d,m,h,p;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=[],e.next=4,t.listMessages({maxPageSize:200});case 4:r=e.sent,a=[],i=!0,c=!1,e.prev=8,s=Object(ee.a)(r.byPage());case 10:return e.next=12,s.next();case 12:return l=e.sent,i=l.done,e.next=16,l.value;case 16:if(u=e.sent,i){e.next=24;break}d=u,m=Object(q.a)(d);try{for(m.s();!(h=m.n()).done;)p=h.value,a.push(p)}catch(f){m.e(f)}finally{m.f()}case 21:i=!0,e.next=10;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(8),c=!0,o=e.t0;case 30:if(e.prev=30,e.prev=31,i||null==s.return){e.next=35;break}return e.next=35,s.return();case 35:if(e.prev=35,!c){e.next=38;break}throw o;case 38:return e.finish(35);case 39:return e.finish(30);case 40:if(void 0!==a){e.next=44;break}return console.error("Unable to get messages from server"),e.abrupt("return");case 44:if(n.push.apply(n,Object($.a)(a.filter((function(e){return"text"===e.type})))),!(n.length>=2e3)){e.next=47;break}return e.abrupt("return",n.slice(0,2e3));case 47:return e.abrupt("break",50);case 50:return e.abrupt("return",n.slice(0,2e3));case 53:e.prev=53,e.t1=e.catch(0),console.error("Failed at getting messages, Error: ",e.t1);case 56:case"end":return e.stop()}}),e,null,[[0,53],[8,26,30,40],[31,,35,39]])})));return function(t){return e.apply(this,arguments)}}(),st=function(){var e=Object(P.a)(R.a.mark((function e(t){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.sendTypingNotification();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Failed at sending typing notification, Error: ",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}(),lt=function(){var e=Object(P.a)(R.a.mark((function e(){var t,n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"GET"},e.next=4,fetch("/getEnvironmentUrl",t);case 4:return n=e.sent,e.abrupt("return",n.text().then((function(e){return e})));case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed at getting environment url, Error: ",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),ut=function(){var e=Object(P.a)(R.a.mark((function e(){var t,n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={method:"POST"},e.next=4,fetch("/token",t);case 4:return n=e.sent,e.abrupt("return",n.json().then((function(e){return e})));case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed at getting token, Error: ",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),dt=function(){var e=Object(P.a)(R.a.mark((function e(t){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){return fetch("/refreshToken/"+t).then((function(t){t.ok?e(t.json().then((function(e){return e.token}))):n(new Error("error"))}),(function(e){n(new Error(e.message))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),mt=function(){var e=Object(P.a)(R.a.mark((function e(t,n){var r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Emoji:n})},e.next=4,fetch("/userConfig/"+t,r);case 4:return e.next=6,e.sent.json;case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error("Failed at setting emoji, Error: ",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}(),ht=function(){var e=Object(P.a)(R.a.mark((function e(t){var n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={headers:{"Content-Type":"application/json"},method:"GET"},e.next=4,fetch("/userConfig/"+t,n);case 4:return e.next=6,e.sent.json();case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed at getting emoji, Error: ",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),pt=function(){var e=Object(P.a)(R.a.mark((function e(t,n){var r;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={chatMessageId:n},e.next=3,t.sendReadReceipt(r);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),ft=function(e){return function(){var t=Object(P.a)(R.a.mark((function t(n,r){var a;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(a=r())&&void 0!==a.calls.call){t.next=4;break}return console.error("state or state.controls.mic is null"),t.abrupt("return");case 4:if(t.prev=4,a.controls.mic){t.next=10;break}return t.next=8,a.calls.call.unmute();case 8:t.next=12;break;case 10:return t.next=12,a.calls.call.mute();case 12:n(je(e)),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(4),console.error(t.t0);case 18:case"end":return t.stop()}}),t,null,[[4,15]])})));return function(e,n){return t.apply(this,arguments)}}()},gt=function(e,t,n){var r=ze.getInstance(Ve.DOMINANT_PARTICIPANTS_COUNT,n);e.on("stateChanged",(function(){var a;r.participantStateChanged(W.getId(e.identifier),null!==(a=e.displayName)&&void 0!==a?a:"",e.state,!e.isMuted,e.videoStreams[0].isAvailable),n(Oe(Object($.a)(t.remoteParticipants.values())))})),e.on("isMutedChanged",(function(){r.participantAudioChanged(W.getId(e.identifier),!e.isMuted)})),e.on("isSpeakingChanged",(function(){n(Oe(Object($.a)(t.remoteParticipants.values())))})),e.on("videoStreamsUpdated",(function(a){a.added.forEach((function(t){"ScreenSharing"===t.mediaStreamType?(t.on("isAvailableChanged",(function(){t.isAvailable?n(Te(t,e)):n({type:"REMOVE_SCREENSHARE_STREAM",stream:t,user:e})})),t.isAvailable&&n(Te(t,e))):"Video"===t.mediaStreamType&&t.on("isAvailableChanged",(function(){r.participantVideoChanged(W.getId(e.identifier),t.isAvailable)}))})),n(Oe(Object($.a)(t.remoteParticipants.values())))}))},vt=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){var a,i;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getMicrophones();case 2:a=e.sent,n(ke(a)),void 0===(i=r()).devices.audioDeviceInfo&&a.length>0?(n(Ce(a[0])),t.selectMicrophone(a[0])):i.devices.audioDeviceInfo&&!W.isSelectedAudioDeviceInList(i.devices.audioDeviceInfo,a)&&t.selectMicrophone(i.devices.audioDeviceInfo);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),bt=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){var a,i;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getCameras();case 2:a=e.sent,n(Ne(a)),void 0===(i=r()).devices.videoDeviceInfo?n(xe(a[0])):i.devices.videoDeviceInfo&&!W.isSelectedVideoDeviceInList(i.devices.videoDeviceInfo,a)&&n(xe(i.devices.videoDeviceInfo));case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Et=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.on("videoDevicesUpdated",Object(P.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:bt(t,n,r);case 1:case"end":return e.stop()}}),e)})))),t.on("audioDevicesUpdated",Object(P.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:vt(t,n,r);case 1:case"end":return e.stop()}}),e)})))),t.askDevicePermission({audio:!0,video:!0}).then((function(e){void 0!==e.audio&&(e.audio?(n(we("Granted")),vt(t,n,r)):n(we("Denied"))),void 0!==e.video&&(e.video?(n(De("Granted")),bt(t,n,r)):n(De("Denied")))}));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ot=function(e,t,n){return function(){var r=Object(P.a)(R.a.mark((function r(a,i){return R.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:Object(Re.b)("verbose"),We(e),ge(t),t.on("callsUpdated",(function(e){e.added.forEach((function(e){console.log("Call added : Call Id = ".concat(e.id));var t=i();t.calls.call&&"Incoming"===e.direction?e.hangUp():(a(ve(e)),e.on("stateChanged",(function(){a(Ee(e.state))})),a(Ee(e.state)),e.on("isScreenSharingOnChanged",(function(){a(Ie(e.isScreenSharingOn))})),a(Ie(e.isScreenSharingOn)),e.on("remoteParticipantsUpdated",(function(t){var n=i();t.added.forEach((function(t){gt(t,e,a),a(Oe([].concat(Object($.a)(n.calls.remoteParticipants),[t])))})),t.removed.length>0&&a(Oe(Object($.a)(e.remoteParticipants.values())))})),a(Oe(Object($.a)(t.calls.remoteParticipants))))})),e.removed.forEach((function(e){var t=i();t.calls.call&&t.calls.call===e&&(a(be(e,t.calls.group)),e.callEndReason&&0!==e.callEndReason.code&&e.callEndReason&&n(e.callEndReason))}))}));case 4:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()},St=function(){var e=Object(P.a)(R.a.mark((function e(t,n){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.hangUp(n).catch((function(e){return console.error(e)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),jt=function(){var e=Object(P.a)(R.a.mark((function e(t,n,r){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.join(n,r);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),console.log("Failed to join a call",e.t0),e.abrupt("return");case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t,n,r){return e.apply(this,arguments)}}(),It=Object(g.b)((function(e){return{messages:e.chat.messages,user:e.contosoClient.user,users:e.contosoClient.users,failedMessages:e.chat.failedMessages,isYourLatestMessage:function(t,n){for(var r=-1,a=void 0,i=0;i<n.length;i++){var c=n[i].createdOn;n[i].sender.communicationUserId===e.contosoClient.user.identity&&n[i]&&new Date(c)>=new Date(r)&&(r=n[i].createdOn,a=n[i].id)}return t===a&&void 0!==a},isLargeParticipantsGroup:function(){return e.threadMembers.threadMembers.length>=20},isMessageSeen:function(t,n){if(!e.conversations.receipts||0===e.conversations.receipts.length)return!1;var r=n.find((function(e){return e.clientMessageId===t})),a=r?r.createdOn:-1;return e.conversations.receipts.filter((function(t){var r;if(z(t.sender,e.contosoClient.user.identity))return!1;var i=null===(r=n.find((function(e){return e.id===t.chatMessageId})))||void 0===r?void 0:r.createdOn;return new Date(i)>=new Date(a)})).length>0},isYourLatestSeenMessage:function(t,n){for(var r=-1,a=void 0,i=0;i<n.length;i++){var c=n[i].createdOn;n[i].isSeen&&n[i].sender.communicationUserId===e.contosoClient.user.identity&&n[i]&&new Date(c)>=new Date(r)&&(r=n[i].createdOn,a=n[i].clientMessageId)}return t===a&&void 0!==a}}}),(function(e){return{sendReadReceipt:function(t,n){if(t&&0!==t.length){for(var r,a=-1,i=void 0,c=0;c<t.length;c++){var o=t[c].createdOn;t[c].sender.communicationUserId!==n&&new Date(o)>new Date(a)&&(a=t[c].createdOn,i=t[c].id)}i&&e((r=i,function(){var e=Object(P.a)(R.a.mark((function e(t,n){var a,i,c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n(),void 0!==(i=a.contosoClient.chatClient)){e.next=5;break}return console.error("Chat Client not created yet"),e.abrupt("return");case 5:if(void 0!==(c=a.thread.threadId)){e.next=9;break}return console.error("Thread Id not created yet"),e.abrupt("return");case 9:return e.t0=pt,e.next=12,i.getChatThreadClient(c);case 12:return e.t1=e.sent,e.t2=r,e.next=16,(0,e.t0)(e.t1,e.t2);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()))}}}}))((function(e){var t,n=Object(l.useState)([]),r=Object(h.a)(n,2),i=r[0],c=r[1],o=Object(l.useState)(e.messages.length),s=Object(h.a)(o,2),d=s[0],m=s[1],p=Object(l.useState)(!0),f=Object(h.a)(p,2),g=f[0],v=f[1],b=Object(l.useState)(!1),N=Object(h.a)(b,2),T=N[0],R=N[1],P=Object(l.useState)(!1),A=Object(h.a)(P,2),M=A[0],L=A[1],_=Object(l.useState)(!1),V=Object(h.a)(_,2),U=V[0],W=V[1],$=Object(l.useState)(0),q=Object(h.a)($,2),ee=q[0],te=q[1],ne=Object(l.useRef)(i),re=Object(l.useRef)(g),ae=Object(l.useRef)(ee);Object(l.useEffect)((function(){var e;e=Math.ceil(X.current.clientHeight/34),ae.current=e,te(e)}),[null===(t=X.current)||void 0===t?void 0:t.clientHeight]),Object(l.useEffect)((function(){de()}),[ee]),Object(l.useEffect)((function(){var t=e.messages&&e.messages[e.messages.length-1]&&e.messages[e.messages.length-1].sender;return e.messages.length>0&&t&&z(t,e.user.identity)?(ce(),de()):g?de():L(!0),window.addEventListener("focus",oe),Q.current.addEventListener("scroll",le),function(){window.removeEventListener("focus",oe),Q.current.removeEventListener("scroll",le)}}),[e.messages]),Object(l.useEffect)((function(){U&&me(),W(!1)}),[U]),Object(l.useEffect)((function(){g&&ce()}),[i]);var ie=function(){ce(),de()},ce=function(){Q.current.scrollTop=Q.current.scrollHeight-Q.current.clientHeight,L(!1)},oe=function(){e.sendReadReceipt(ne.current,e.user.identity)},se=function(t){if(t.failed)return void 0!==e.failedMessages.find((function(e){return e===t.clientMessageId}))?u.a.createElement(S.a,{content:"failed to send"},u.a.createElement(a.RedbangIcon,{size:"medium",styles:{color:"red"}})," "):u.a.createElement(S.a,{content:"sending"},u.a.createElement(a.PresenceStrokeIcon,{size:"medium"})," ");if(!e.isLargeParticipantsGroup()){var n=i.map((function(t){var n=e.isMessageSeen(t.clientMessageId,i);return Object(O.a)(Object(O.a)({},t),{},{isSeen:n})}));if(e.isYourLatestSeenMessage(t.clientMessageId,n))return u.a.createElement(S.a,{content:"seen"},u.a.createElement(a.MessageSeenIcon,{size:"medium"}))}return e.isYourLatestMessage(t.id,i)?u.a.createElement(S.a,{content:"sent"},u.a.createElement(a.PresenceAvailableIcon,{size:"medium"})):u.a.createElement("div",{className:G})},le=function(){var e,t=Q.current.scrollTop>=Q.current.scrollHeight-Q.current.clientHeight,n=0===Q.current.scrollTop;t&&!re.current&&ie(),e=t,re.current=e,v(e),R(n)},ue=function(){m(d>10?d-10:0),W(!0)},de=function(){m(e.messages.length>ae.current?e.messages.length-ae.current:0),W(!0)},me=function(){var t,n=[];e.messages.slice(d,e.messages.length).map((function(t,r,a){var i=t.sender.communicationUserId===e.user.identity,c=!1;0===r?r!==a.length-1&&a[r].sender.communicationUserId===a[r+1].sender.communicationUserId&&(c="top"):a[r].sender.communicationUserId===a[r-1].sender.communicationUserId?c=r!==a.length-1&&a[r].sender.communicationUserId===a[r+1].sender.communicationUserId||"bottom":r!==a.length-1&&a[r].sender.communicationUserId===a[r+1].sender.communicationUserId&&(c="top");var o=Object(O.a)(Object(O.a)({},t),{},{attached:c,mine:i});n.push(o)})),t=n,ne.current=t,c(t)};return u.a.createElement(y.a,{innerRef:X},u.a.createElement(E.a,{className:H},T&&u.a.createElement(w.a,{text:!0,fluid:!0,className:J,content:0===d?"You have reached the beginning of the thread":"click to load more messages...",disabled:0===d,onClick:function(){ue()}}),u.a.createElement(y.a,{innerRef:Q},u.a.createElement(x.a,null,u.a.createElement(D.a,{styles:B,items:i.map((function(t,n){var r,a="".concat(t.senderDisplayName," says "),i=u.a.createElement("div",null,u.a.createElement(x.b,{message:"".concat(t.mine?"":a," ").concat(t.content),"aria-live":"polite"}),t.content.message.split(" ").map((function(e){return k.test(e)?u.a.createElement("a",{href:e,target:"_blank",rel:"noopener noreferrer"},e," "):e+" "})));return{gutter:t.mine?"":u.a.createElement("div",{className:F(void 0===e.users[t.sender.communicationUserId]?"":e.users[t.sender.communicationUserId].emoji)},void 0===e.users[t.sender.communicationUserId]?"":e.users[t.sender.communicationUserId].emoji),key:n,contentPosition:t.mine?"end":"start",message:u.a.createElement(C.a,{vAlign:"end"},u.a.createElement(D.a.Message,{styles:(r=t.mine,{backgroundColor:r?"rgba(42, 161,255, 0.25)":"rgba(243,242,241)",overflowY:"hidden"}),content:i,author:t.senderDisplayName,mine:t.mine}),u.a.createElement("div",{className:Y(t.mine)},se(t))),attached:t.attached}}))}))),M&&u.a.createElement("div",null,u.a.createElement(j.a,{className:K,onClick:ie},u.a.createElement(I.a,{iconName:"Down",className:Z}),"New Messages"))))})),yt=n(1176),wt=Object(p.D)({width:"100%",height:"2.25rem"}),Dt={wrapper:{height:"2.25rem"},fieldGroup:{height:"2.25rem"}},Ct=Object(p.D)({border:"0rem",color:"black",backgroundColor:"#EEF2F5",fontWeight:400,fontSize:"1rem",width:"100%",height:"2.25rem","::-webkit-input-placeholder":{fontSize:"1rem"},"::-moz-placeholder":{fontSize:"1rem"},":-moz-placeholder":{fontSize:"1rem"}}),xt=Object(p.D)({backgroundColor:"#EEF2F5",width:"2.25rem",height:"2.25rem",color:"grey",paddingLeft:"0.5rem",paddingTop:"0.625rem",fontSize:"0.875rem"}),kt=Object(g.b)((function(e){return{user:e.contosoClient.user}}),(function(e){return{onSendMessage:function(t){return e(function(e){return function(){var t=Object(P.a)(R.a.mark((function t(n,r){var a,i,c,o,s,l,u,d;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r(),void 0!==(i=a.contosoClient.chatClient)){t.next=5;break}return console.error("Chat Client not created yet"),t.abrupt("return");case 5:if(void 0!==(c=a.thread.threadId)){t.next=9;break}return console.error("Thread Id not created yet"),t.abrupt("return");case 9:return o=a.contosoClient.user.displayName,s=a.contosoClient.user.identity,l=(Math.floor(0x8000000000000000*Math.random())+1).toString(),u=U(s,o,l,e),(d=r().chat.messages).push(u),n(ie(d)),t.t0=it,t.next=19,i.getChatThreadClient(c);case 19:return t.t1=t.sent,t.t2=e,t.t3=o,t.t4=l,t.t5=n,t.t6=r,t.next=27,(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5,t.t6);case 27:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}(t))},onSendTypingNotification:function(t,n){var r=new Date;r.getTime()-t>=8e3&&(e(function(){var e=Object(P.a)(R.a.mark((function e(t,n){var r,a,i;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n(),void 0!==(a=r.contosoClient.chatClient)){e.next=5;break}return console.error("Chat Client not created yet"),e.abrupt("return");case 5:if(void 0!==(i=r.thread.threadId)){e.next=9;break}return console.error("Thread Id not created yet"),e.abrupt("return");case 9:return e.t0=st,e.next=12,a.getChatThreadClient(i);case 12:return e.t1=e.sent,e.next=15,(0,e.t0)(e.t1);case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),n(r.getTime()))}}}))((function(e){var t=Object(l.useState)(""),n=Object(h.a)(t,2),r=n[0],i=n[1],c=Object(l.useState)(!1),o=Object(h.a)(c,2),s=o[0],d=o[1],m=Object(l.useState)(0),p=Object(h.a)(m,2),f=p[0],g=p[1],v=function(){N.test(r)||(e.onSendMessage(r),i(""))};return u.a.createElement("div",null,u.a.createElement(E.a,{horizontal:!0},u.a.createElement(yt.a,{className:wt,id:"sendbox",borderless:!0,ariaLabel:"Type",inputClassName:Ct,placeholder:"Type your message",value:r,onChange:function(e){e.target.value.length>8e3?d(!0):d(!1),i(e.target.value)},autoComplete:"off",onKeyUp:function(t){13!==t.which||s||v(),e.onSendTypingNotification(f,g)},styles:Dt}),u.a.createElement(a.SendIcon,{outline:!0,className:xt,id:"sendmessage",onClick:function(){s||v()}})))})),Nt=Object(p.D)({height:"2.125rem",display:"flex",alignItems:"center"}),Tt=Object(p.D)({fontWeight:400,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",paddingRight:"0.1875rem"}),Rt=Object(p.D)({fontWeight:400,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",paddingRight:"0.1875rem"}),Pt=Object(g.b)((function(e){return{generateTypingIndicatorList:function(){var t=e.chat.typingUsers,n=e.contosoClient.users,r=e.contosoClient.user,a="",i=t.filter((function(e){return e.id.communicationUserId!==r.identity}));if(0===i.length||e.threadMembers.threadMembers.length>=20)return a;if(i.length>0&&(a+=i.filter((function(e){return void 0!==n[e.id.communicationUserId]})).slice(0,2).map((function(e){return"".concat(n[e.id.communicationUserId].emoji).concat(e.displayName)})).join(", ")),i.length>2){var c=i.length-2;a+=" and ".concat(c," other").concat(1===c?"":"s")}return a.length>35&&(a="".concat(i.length," participant").concat(1===i.length?"":"s")),a},generateTypingIndicatorVerb:function(){var t=e.chat.typingUsers,n=e.contosoClient.user,r="",a=t.filter((function(e){return e.id.communicationUserId!==n.identity}));return 0===a.length||e.threadMembers.threadMembers.length>=20?r:r=(a.length>1?" are":" is")+" typing..."}}}))((function(e){return u.a.createElement("div",{className:Nt},u.a.createElement("span",{className:Tt},e.generateTypingIndicatorList()),u.a.createElement("span",{className:Rt},e.generateTypingIndicatorVerb()))})),At=Object(p.D)({height:"100%",width:"100%",marginLeft:"6%",marginRight:"6%",paddingBottom:"1rem",overflow:"auto"}),Mt=Object(g.b)((function(e){return{typingNotifications:e.chat.typingNotifications}}),(function(e){return{onUpdateTypingUsers:function(){return e(function(){var e=Object(P.a)(R.a.mark((function e(t,n){var r,a,i,c,o;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=n(),i=a.chat.typingNotifications,c=function(e){var t=i[e];if(!t.originalArrivalTime)return"continue";if(Ze(t.originalArrivalTime)){var n=a.threadMembers.threadMembers.find((function(t){return z(t.id,e)}));n&&r.push(n)}},e.t0=R.a.keys(i);case 5:if((e.t1=e.t0()).done){e.next=12;break}if(o=e.t1.value,"continue"!==c(o)){e.next=10;break}return e.abrupt("continue",5);case 10:e.next=5;break;case 12:t(oe(r));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}}))((function(e){var t=e.onUpdateTypingUsers;return Object(l.useEffect)((function(){var e=setInterval((function(){t()}),500);return function(){clearInterval(e)}}),[t]),u.a.createElement(E.a,{className:At},u.a.createElement(It,null),u.a.createElement(Pt,null),u.a.createElement(kt,null))})),Lt=n(1179),_t=n(442),zt=n(450),Vt=n(390),Ut=n(391),Wt=Object(p.y)().palette,Ft={childrenGap:5},Ht={field:{color:Wt.neutralSecondary,padding:0},root:{marginLeft:"1rem",marginRight:"1rem"},fieldGroup:{border:"none"}},Gt=Object(p.D)({fontSize:"1rem",fontWeight:600,marginLeft:"1rem",marginRight:"1rem",marginTop:"1rem"}),Bt=Object(p.D)({fontWeight:600,height:"2.5rem",marginLeft:"1rem",marginRight:"1rem",width:"90%"}),Yt=Object(p.D)({marginRight:"0.5em",fontSize:"0.875rem"}),Kt=Object(p.D)({fontSize:"1rem"}),Jt=function(e){return Object(p.D)({height:"100%",width:"17.813rem",display:e?"flex":"none",borderLeft:"0.063rem solid #DDDDDD"})},Zt=Object(p.D)({marginLeft:"1rem",marginTop:"1rem",fontSize:"1rem",height:"1.375rem",marginBottom:"1.25rem",fontWeight:600}),Qt=Object(p.D)({height:"100%",width:"100%",maxHeight:"100%",overflow:"auto"}),Xt=Object(p.D)({height:"100%",width:"100%",maxHeight:"100%"}),$t=Object(p.D)({marginRight:"0.5em",fontSize:"0.875rem"}),qt=Object(p.D)({fontWeight:600,height:"2.5rem",marginLeft:"1rem",paddingRight:"1rem",width:"90%"}),en=(Object(p.D)({bottom:"1rem",minHeight:"7.25rem",borderTop:"0.063rem solid #DDDDDD"}),Object(p.D)({border:"1px solid #CCCCCC",borderRadius:"2px",fontWeight:600,height:"2.5rem",marginLeft:"1rem",marginRight:"1rem",marginTop:"1rem",width:"90%"}),Object(p.D)({marginRight:"0.5rem"}),Object(p.D)({paddingLeft:"1rem",paddingTop:"0.625rem",color:"#605E5C"}),Object(p.D)({minHeight:"7.25rem",borderTop:"0.063rem solid #DDDDDD"})),tn={root:{marginBottom:"1.25rem"}},nn=Object(p.D)({height:"1.75rem",backgroundColor:"#FFFFFF",color:"red",fontSize:"0.75rem",paddingLeft:"1rem",paddingBottom:"0.5rem"}),rn=Object(p.D)({height:"1.75rem",paddingBottom:"1.75rem"}),an=Object(p.D)({fontSize:"0.875rem"}),cn=Object(p.D)({fontSize:"0.875rem",fontWeight:600,marginTop:"0.5rem",marginLeft:"1rem"}),on=Object(p.D)({boxSizing:"border-box",height:"2.5rem",width:"90%",border:"0.125rem solid #CCCCCC",borderRadius:"0.188rem",backgroundColor:"#FFFFFF",marginTop:"0.375rem",marginBottom:"0.25rem",marginLeft:"1rem",fontSize:"1rem"}),sn=Object(p.D)({boxSizing:"border-box",height:"2.5rem",width:"90%",border:"0.125rem solid #FF0000",borderRadius:"0.188rem",backgroundColor:"#FFFFFF",marginTop:"0.375rem",marginBottom:"0.25rem",marginLeft:"1rem",fontSize:"1rem"}),ln=Object(p.D)({width:"100%",height:"auto",paddingLeft:"3.25rem",paddingRight:"3.25rem",marginTop:"1rem",selectors:{"@media (max-width: 65rem)":{paddingLeft:"5%",paddingRight:"5%"}},borderBottom:"0.063rem solid #DDDDDD"}),un=(Object(p.D)({height:"100%",maxWidth:"100%",display:"flex",alignItems:"center",marginLeft:"0.625rem"}),Object(p.D)({color:"#323130",fontSize:"1rem",fontWeight:600,marginRight:"0.125rem",width:"31.25rem",wordBreak:"break-all",overflowY:"hidden"})),dn=(Object(p.D)({color:"#A19F9D",fontSize:"1rem",fontWeight:600,width:"100%",height:"100%"}),Object(p.D)({height:"100%",display:"flex",alignItems:"center"}),Object(p.D)({marginRight:"0.625rem",width:"6.688rem",borderWidth:"0.125rem",borderColor:"#CCCCCC",color:"#323130",fontSize:"0.875rem",fontWeight:600})),mn=(Object(p.D)({color:"#323130",marginRight:"0.5rem"}),Object(p.D)({padding:"0px 13px"})),hn=Object(p.y)().palette,pn={linkIsSelected:{padding:0,marginRight:0,height:"100%",color:hn.themePrimary,selectors:{":hover":{color:hn.themePrimary}}},link:{padding:0,marginRight:0,height:60},root:{width:84,height:60,marginRight:"0.5rem",display:"inline-block",verticalAlign:"top"}},fn=(Object(p.D)({whiteSpace:"nowrap",selectors:{"@media (min-width: 50rem)":{display:"none"}}}),Object(p.D)({whiteSpace:"nowrap",selectors:{"@media (max-width: 50rem)":{display:"none"}}})),gn=n(299),vn=n(1192),bn=n(76),En=function(){var e;document.getElementById("inputText").select(),document.execCommand("copy"),null===(e=document.getElementById("copyLinkButton"))||void 0===e||e.focus()},On=function(){return u.a.createElement(E.a,{styles:tn,className:en,tokens:Ft},u.a.createElement("div",{className:Gt},"Invite people to join"),u.a.createElement(yt.a,{inputClassName:Kt,tabIndex:-1,ariaLabel:"Join link",styles:Ht,id:"inputText",type:"text",value:"".concat(document.baseURI)}),u.a.createElement(j.a,{"tab-index":"-1",id:"copyLinkButton",className:Bt,onClick:En},u.a.createElement(I.a,{iconName:"Copy",className:Yt}),u.a.createElement("div",{className:an},"Copy invite link")))},Sn=n(1191),jn=Object(p.D)({marginLeft:"1rem",marginRight:"0.5rem",marginTop:"0.125rem",marginBottom:"0.125rem",display:"flex",position:"relative"}),In=Object(p.D)({fontSize:"0.875rem",fontWeight:400,marginTop:"0.3125rem",marginRight:"0.25rem",paddingLeft:"0.25rem",overflowY:"hidden"}),yn=Object(p.D)({fontSize:"0.875rem",fontWeight:400,color:"#A19F9D",marginTop:"0.3125rem",marginLeft:"0.3125rem"}),wn=Object(p.D)({position:"absolute",right:"1rem"}),Dn=function(e){return u.a.createElement("div",{className:jn},u.a.createElement("div",{className:F(e.avatar)},e.avatar),u.a.createElement("span",{className:In},e.name),e.isYou&&u.a.createElement("span",{className:yn},"(you)"),!e.isYou&&u.a.createElement("div",{className:wn},u.a.createElement(Sn.a,{menuIconProps:{iconName:"More"},menuProps:{items:e.isYou?[]:[{key:e.name,name:"Remove participant",onClick:function(){e.removeThreadMemberByUserId(e.userId)}}]}})))},Cn=Object(p.D)({display:"flex",flexDirection:"row",selectors:{"@media (max-width: 37.5rem)":{flexDirection:"column"}}}),xn=Object(p.D)({height:"10.563rem",width:"8.313rem",marginRight:"9.688rem",selectors:{"@media (max-width: 37.5rem)":{marginRight:"0rem"}}}),kn=Object(p.D)({height:"14.75rem",width:"19rem",selectors:{"@media (max-width: 37.5rem)":{marginTop:"6.25rem"}}}),Nn=function(e,t){var n;return Object(p.D)({width:"3rem",height:"3rem",border:e===t?"0.125rem solid #0378D4":"",backgroundColor:null===(n=M(e))||void 0===n?void 0:n.backgroundColor,borderRadius:"50%",alignItems:"center",display:"flex",justifyContent:"center",outline:"none"})},Tn=function(e){var t;return Object(p.D)({width:"8.25rem",height:"8.25rem",backgroundColor:null===(t=M(e))||void 0===t?void 0:t.backgroundColor,borderRadius:"50%",alignItems:"center",display:"flex",justifyContent:"center"})},Rn=Object(p.D)({height:"1.75rem",width:"2rem",color:"#444444",fontWeight:400,fontSize:"1.5rem",letterSpacing:"0",lineHeight:"1.75rem",textAlign:"center"}),Pn=Object(p.D)({height:"4.938rem",color:"#444444",fontWeight:400,fontSize:"3.75rem",letterSpacing:"0",lineHeight:"4.938rem",textAlign:"center"}),An=Object(p.D)({height:"1.188rem",width:"2.625rem",color:"#444444",fontSize:"1rem",fontWeight:600,letterSpacing:"0",lineHeight:"2rem",marginBottom:"0.625rem"}),Mn=(Object(p.D)({height:"1.25rem",color:"#A19F9D",fontWeight:400,fontSize:"1rem",letterSpacing:"0",lineHeight:"1.125rem"}),Object(p.D)({maxWidth:"46.875rem",width:"100%",height:"100%",selectors:{"@media (max-width: 46.875rem)":{padding:10,height:"100%"}},horizontalAlign:"center",verticalAlign:"center"}),Object(p.D)({boxSizing:"border-box",height:"2.5rem",width:"18.75rem",border:"0.125rem solid #CCCCCC",borderRadius:"0.188rem",backgroundColor:"#FFFFFF",marginTop:"0.375rem",marginBottom:"0.875rem"})),Ln=Object(p.D)({fontSize:"1rem",lineHeight:"1.5rem","::-webkit-input-placeholder":{fontSize:"1rem"},"::-moz-placeholder":{fontSize:"1rem"},":-moz-placeholder":{fontSize:"1rem"}}),_n={wrapper:{height:"2.25rem"},fieldGroup:{height:"2.25rem"}},zn=(Object(p.D)({fontSize:"1rem",lineHeight:"1.5rem",color:"red"}),Object(p.D)({boxSizing:"border-box",height:"2.5rem",width:"18.75rem",border:"0.125rem solid #FF0000",borderRadius:"0.188rem",backgroundColor:"#FFFFFF",marginTop:"0.375rem",marginBottom:"0.875rem",fontSize:"1rem"})),Vn=Object(p.D)({width:"18.75rem",backgroundColor:"#FFFFFF",marginTop:"0.188rem",marginBottom:"0.188rem",marginLeft:"0.188rem",color:"red",fontSize:"1rem"}),Un=Object(p.D)({marginRight:"0.375rem",fontSize:"0.875rem"}),Wn=Object(p.D)({height:"2.75rem",fontWeight:600,width:"100%",maxWidth:"18.75rem",minWidth:"12.5rem",fontSize:"0.875rem"}),Fn=Object(p.D)({maxWidth:"46.875rem",width:"100%",height:"100%",selectors:{"@media (max-width: 46.875rem)":{padding:"0.625rem",height:"100%"}}}),Hn=Object(p.D)({fontSize:"0.875rem"});!function(e){e.None="none",e.People="People",e.Settings="Settings"}(Ue||(Ue={}));var Gn,Bn,Yn=Object(g.b)((function(e){return{threadMembers:e.threadMembers.threadMembers,topic:e.thread.topic,userId:e.contosoClient.user.identity,existsTopicName:"c774da81-94d5-4652-85c7-6ed0e8dc67e6"!==e.thread.topic,generateHeaderMessage:function(){var t="Chat with ";if(void 0===e.threadMembers)return t+="yourself";var n=e.threadMembers.threadMembers.filter((function(t){return!z(t.id,e.contosoClient.user.identity)}));if(0===n.length)return t+="yourself";n.length>0&&(t+=n.slice(0,3).map((function(e){return e.displayName})).join(", "));if(n.length>3){var r=n.length-3;t+=" and ".concat(r," other participant").concat(1===r?"":"s")}return t}}}),(function(e){return{removeChatParticipantById:function(t){return e(qe(t))}}}))((function(e){var t=Object(l.useState)(""),n=Object(h.a)(t,2),r=n[0],a=n[1],i=function(e,t){return e!==Ue.People?t(Ue.People):t(Ue.None)},c=function(e,t){return e!==Ue.Settings?t(Ue.Settings):t(Ue.None)},o=e.topic,s=e.generateHeaderMessage,d=e.leaveChatHandler,m=e.removeChatParticipantById,p=e.userId,f=e.startCallHandler;return Object(l.useEffect)((function(){a(o&&"c774da81-94d5-4652-85c7-6ed0e8dc67e6"!==o?o:s())}),[o,s]),u.a.createElement(E.a,{className:ln,horizontal:!0,horizontalAlign:"space-between"},u.a.createElement(E.a.Item,{align:"center"},u.a.createElement("div",{className:un},r)),u.a.createElement(E.a.Item,{align:"center"},u.a.createElement(E.a,{horizontal:!0},u.a.createElement(E.a.Item,{align:"center"},u.a.createElement(Lt.a,{onKeyDownCapture:function(e){e.target.id===Ue.People&&39===e.keyCode&&e.preventDefault()},getTabId:function(e){return e},onLinkClick:function(t){return function(t){t&&(t.props.itemKey===Ue.Settings&&c(e.selectedPane,e.setSelectedPane),t.props.itemKey===Ue.People&&i(e.selectedPane,e.setSelectedPane))}(t)},styles:pn,defaultSelectedKey:Ue.None,selectedKey:e.selectedPane},u.a.createElement(_t.a,{itemKey:Ue.None}),u.a.createElement(_t.a,{itemKey:Ue.People,onRenderItemLink:function(){return u.a.createElement(Vt.a,{outline:e.selectedPane!==Ue.People,size:"medium",className:mn})}}),u.a.createElement(_t.a,{itemKey:Ue.Settings,onRenderItemLink:function(){return u.a.createElement(Ut.a,{outline:e.selectedPane!==Ue.Settings,size:"medium",className:mn})}}))),u.a.createElement(E.a.Item,{align:"center"},u.a.createElement("div",{className:fn},u.a.createElement(zt.a,{id:"leave",className:dn,onClick:function(){d(),m(p)}},u.a.createElement(I.a,{iconName:"Leave",className:Yt}),"Leave"))),u.a.createElement(E.a.Item,{align:"center"},u.a.createElement("div",{className:fn},u.a.createElement(zt.a,{id:"joinCall",className:dn,onClick:function(){f()}},u.a.createElement(I.a,{iconName:"Phone",className:Yt}),"Join Call"))))))})),Kn=Object(g.b)((function(e){return{identity:e.contosoClient.user.identity,chatParticipants:e.threadMembers.threadMembers,users:e.contosoClient.users,existsTopicName:"c774da81-94d5-4652-85c7-6ed0e8dc67e6"!==e.thread.topic,topic:e.thread.topic,threadId:e.thread.threadId,chatClient:e.contosoClient.chatClient,updateThreadTopicName:function(e,t,n,r){tt(e,t,n,r)}}}),(function(e){return{setContosoUsers:function(e){return re(e)},removeChatParticipantById:function(){var t=Object(P.a)(R.a.mark((function t(n){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(qe(n));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}))((function(e){var t=Object(l.useState)(""),n=Object(h.a)(t,2),r=n[0],a=n[1],i=Object(l.useState)(!1),c=Object(h.a)(i,2),o=(c[0],c[1]),s=Object(l.useState)(!1),d=Object(h.a)(s,2),m=d[0],p=d[1],f=Object(l.useState)(!1),g=Object(h.a)(f,2),v=g[0],b=g[1],O=e.chatClient,S=e.threadId,y=function(){r.length>30||O&&S&&(e.updateThreadTopicName(O,S,r,b),b(!0),o(!1),setTimeout((function(){var e;null===(e=document.getElementById("focusButton"))||void 0===e||e.focus()}),100))};return u.a.createElement(u.a.Fragment,null,u.a.createElement(E.a,{verticalAlign:"space-between",className:Jt(e.selectedPane===Ue.People)},u.a.createElement("span",{className:Zt},"People"),u.a.createElement(gn.a,{className:Qt},u.a.createElement(vn.a,{direction:bn.a.vertical},e.chatParticipants.map((function(t){var n=t.id.communicationUserId;return u.a.createElement(Dn,{key:n,userId:n,avatar:void 0===e.users[n]?"":e.users[n].emoji,name:t.displayName,isYou:n===e.identity,removeThreadMemberByUserId:e.removeChatParticipantById})})))),u.a.createElement(On,null)),u.a.createElement(E.a,{verticalAlign:"space-between",className:Jt(e.selectedPane===Ue.Settings)},u.a.createElement("div",{className:Zt},"Settings"),u.a.createElement("div",{className:Xt},u.a.createElement("div",{className:cn},"Group Name"),u.a.createElement(yt.a,{className:m?sn:on,inputClassName:Ln,borderless:!0,defaultValue:"c774da81-94d5-4652-85c7-6ed0e8dc67e6"===e.topic?"":e.topic,placeholder:e.existsTopicName?void 0:"Type a group name",autoComplete:"off",onSubmit:y,onChange:function(e){o(!0),a(e.target.value),e.target.value.length>30?p(!0):p(!1)},onKeyUp:function(e){13===e.which&&y()}}),m&&u.a.createElement("div",{className:nn}," Topic cannot be over 30 characters ")||!m&&u.a.createElement("div",{className:rn}),u.a.createElement(j.a,{id:"editThreadTopicButton",className:qt,onClick:function(e){return y()},disabled:v},u.a.createElement(I.a,{iconName:"Save",className:$t}),u.a.createElement("div",{className:an},v?"Saving...":"Save")))))})),Jn=Object(p.D)({height:"100%",width:"100%"}),Zn=Object(p.D)({height:"100%",width:"100%",maxHeight:"100%",overflow:"auto"}),Qn=Object(g.b)((function(e){return{isRemoved:e.threadMembers.isRemoved}}))((function(e){var t=Object(l.useState)(window.innerWidth>600?Ue.People:Ue.None),n=Object(h.a)(t,2),r=n[0],a=n[1],i=e.leaveChatHandler,c=e.isRemoved,o=e.removedFromThreadHandler,s=e.startCallHandler;return Object(l.useEffect)((function(){var e;null===(e=document.getElementById("sendbox"))||void 0===e||e.focus()}),[]),Object(l.useEffect)((function(){c&&o()}),[c,o]),u.a.createElement(E.a,{className:Jn},u.a.createElement(Yn,{leaveChatHandler:i,selectedPane:r,setSelectedPane:a,startCallHandler:s}),u.a.createElement(E.a,{className:Zn,horizontal:!0},u.a.createElement(Mt,null),u.a.createElement(E.a.Item,{grow:!0,disableShrink:!0},u.a.createElement(Kn,{selectedPane:r,setSelectedPane:a}))))})),Xn=n(1184),$n=n(392),qn=function(e){return u.a.createElement("div",null,u.a.createElement("div",{className:An},"Name"),u.a.createElement(yt.a,{autoComplete:"off",inputClassName:Ln,ariaLabel:"Choose your name",borderless:!0,className:e.isEmpty||e.isNameLengthExceedLimit?zn:Mn,onChange:function(t){e.setName(t.target.value),t.target.value?t.target.value.length>10?e.setNameLengthExceedLimit(!0):(e.setEmptyWarning(!1),e.setNameLengthExceedLimit(!1)):e.setEmptyWarning(!0)},id:"name",placeholder:"Enter your name",onKeyDown:function(t){13===t.which&&e.validateName()},styles:_n}),e.isEmpty&&u.a.createElement("div",{role:"alert",className:Vn}," ","Name cannot be empty"," ")||e.isNameLengthExceedLimit&&u.a.createElement("div",{role:"alert",className:Vn}," ","Name cannot be over 10 characters"," "))},er=Object(g.b)(void 0,(function(e){return{setup:function(){var t=Object(P.a)(R.a.mark((function t(n,r){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(He(n,r));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),isValidThread:function(){var t=Object(P.a)(R.a.mark((function t(n){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e(Qe(n)));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}}))((function(e){var t=["\ud83d\udc31","\ud83d\udc2d","\ud83d\udc28","\ud83d\udc19","\ud83d\udc35","\ud83e\udd8a"],n=Object(l.useState)(""),r=Object(h.a)(n,2),a=r[0],i=r[1],c=Object(l.useState)(!1),o=Object(h.a)(c,2),s=o[0],d=o[1],m=Object(l.useState)(!1),f=Object(h.a)(m,2),g=f[0],v=f[1],b=Object(l.useState)("\ud83d\udc31"),O=Object(h.a)(b,2),S=O[0],I=O[1],y=Object(l.useState)(!1),w=Object(h.a)(y,2),D=w[0],C=w[1],x=Object(l.useState)(void 0),k=Object(h.a)(x,2),N=k[0],T=k[1],A=e.joinChatHandler,M=e.setup,_=function(){a?a.length>10?(d(!1),v(!0)):(d(!1),v(!1),D||(M(a,S),C(!0))):(d(!0),v(!1))},z=e.isValidThread;Object(l.useEffect)((function(){var e;(function(){var e=Object(P.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(L());case 2:if(!e.sent){e.next=6;break}T(!0),e.next=7;break;case 6:T(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()(),null===(e=document.getElementById("\ud83d\udc31"))||void 0===e||e.focus()}),[z]);var V=function(){return u.a.createElement("div",null,u.a.createElement(E.a,{className:Cn,horizontal:!0,horizontalAlign:"center",verticalAlign:"center"},u.a.createElement(E.a,{className:xn,horizontal:!1,verticalAlign:"center",horizontalAlign:"center",tokens:{childrenGap:13}},u.a.createElement("div",{className:Tn(S)},u.a.createElement("div",{className:Pn},S)),u.a.createElement("div",{"aria-label":"Display name",className:(e=""!==a,Object(p.D)({height:"1.5rem",width:"8.313rem",fontSize:"1.125rem",fontWeight:600,letterSpacing:"0",lineHeight:"1.5rem",textAlign:"center",opacity:e?1:.34,color:e?"#000000":"#A19F9D",wordWrap:"break-word",overflowY:"hidden"}))},""!==a?a:"Name")),u.a.createElement(E.a,{className:kn,horizontal:!1,tokens:{childrenGap:20}},u.a.createElement("div",null,u.a.createElement("div",{className:An},"Avatar"),u.a.createElement(vn.a,{direction:bn.a.horizontal},u.a.createElement(E.a,{role:"list",horizontal:!0,tokens:{childrenGap:4}},t.map((function(e,t){return u.a.createElement("div",{role:"listitem",id:e,key:t,tabIndex:0,"data-is-focusable":!0,className:Nn(e,S),onFocus:function(){I(e)}},u.a.createElement("div",{className:Rn},e))}))))),u.a.createElement(qn,{setName:i,setEmptyWarning:d,setNameLengthExceedLimit:v,validateName:_,isEmpty:s,isNameLengthExceedLimit:g}),u.a.createElement("div",null,u.a.createElement(j.a,{id:"join",className:Wn,onClick:function(){_(),!1===s&&!1===g&&A()}},u.a.createElement($n.a,{className:Un,size:"medium"}),u.a.createElement("div",{className:Hn},"Join chat"))))));var e};return D?u.a.createElement(Xn.a,{label:"Initializing chat client...",ariaLive:"assertive",labelPosition:"top"}):u.a.createElement(E.a,{className:Fn,horizontalAlign:"center",verticalAlign:"center"},!1===N?u.a.createElement("div",null,u.a.createElement("p",null,"thread Id is not valid")):V())})),tr=n(40),nr=n(244),rr=n(1185),ar=n(393),ir=n(394),cr=n(151),or=n.n(cr),sr=Object(p.y)().palette,lr={root:{marginBottom:0}},ur={root:{width:"10rem",height:"10.5rem"}},dr={childrenGap:"0.625rem",padding:"0.625rem"},mr=Object(p.D)({maxWidth:"25rem",minWidth:"12.5rem",width:"100%",height:"100%",maxHeight:"18.75rem",minHeight:"12.5rem",background:sr.neutralLighter,color:sr.neutralPrimaryAlt}),hr=Object(p.D)({height:"2.8125rem",width:"100%",backgroundColor:sr.neutralQuaternaryAlt}),pr=Object(p.D)({width:"100%",height:"100%",maxHeight:"15.9375rem"}),fr=function(e){var t={src:or.a.toString(),imageFit:tr.b.cover,maximizeFrame:!0};return Object(l.useEffect)((function(){return Object(P.a)(R.a.mark((function t(){var n,r;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.localVideoStream){t.next=7;break}return n=new fe.VideoStreamRenderer(e.localVideoStream),t.next=4,n.createView({scalingMode:"Crop",isMirrored:!0});case 4:Gn=t.sent,(r=document.getElementById(Ve.CONFIGURATION_LOCAL_VIDEO_PREVIEW_ID))&&0===r.childElementCount&&r.appendChild(Gn.target);case 7:case"end":return t.stop()}}),t)})))(),function(){Gn&&(Gn.dispose(),Gn=void 0)}}),[e.localVideoStream]),u.a.createElement(E.a,{className:mr},u.a.createElement(E.a,{horizontalAlign:"center",verticalAlign:"center",id:Ve.CONFIGURATION_LOCAL_VIDEO_PREVIEW_ID,className:pr},!e.localVideoStream&&u.a.createElement(nr.a,Object.assign({styles:ur},t,{"aria-label":"Local video preview image"}))),u.a.createElement(E.a,{horizontal:!0,horizontalAlign:"center",verticalAlign:"center",tokens:dr,className:hr},u.a.createElement(ar.a,{size:"medium"}),u.a.createElement(rr.a,{checked:void 0!==e.localVideoStream,styles:lr,disabled:!e.videoDeviceInfo||0===e.videoDeviceList.length,onChange:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new fe.LocalVideoStream(e.videoDeviceInfo);e.setLocalVideoStream(n?r:void 0)},ariaLabel:"Video Icon"}),u.a.createElement(ir.a,{size:"medium"}),u.a.createElement(rr.a,{checked:e.mic,styles:lr,disabled:!e.audioDeviceInfo||0===e.audioDeviceList.length,onChange:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.setMic(n)},ariaLabel:"Microphone Icon"})))},gr=n(1171),vr={childrenGap:"1.5rem"},br={childrenGap:"0.75rem"},Er={caretDownWrapper:{height:"2.5rem",lineHeight:"2.5rem"},dropdownItem:{fontWeight:600,fontSize:"0.875rem",height:"2.5rem"},dropdown:{height:"2.5rem"},title:{fontWeight:600,fontSize:"0.875rem",height:"2.5rem",lineHeight:"2.3125rem"},label:{fontWeight:600,fontSize:"0.875rem"}},Or=Object(p.D)({width:"100%",maxWidth:"18.75rem",minWidth:"12.5rem",maxHeight:"14.125rem",marginTop:"2.125rem"}),Sr=function(e){var t=function(e){return e.map((function(e){return{val:e,key:e.id,text:""===e.name?e.deviceType:e.name}}))};return u.a.createElement(E.a,{className:Or,tokens:vr},u.a.createElement(gr.a,{placeholder:"Select an option",label:"Camera",options:t(e.videoDeviceList),styles:Er,disabled:0===e.videoDeviceList.length,defaultSelectedKey:e.videoDeviceInfo?e.videoDeviceInfo.id:"",onChange:function(){var t,n=null!==(t=arguments.length<=2?void 0:arguments[2])&&void 0!==t?t:0;e.setVideoDeviceInfo(e.videoDeviceList[n])}}),u.a.createElement(E.a,{tokens:br},u.a.createElement(gr.a,{placeholder:"Select an option",label:"Microphone",styles:Er,disabled:0===e.audioDeviceList.length,options:t(e.audioDeviceList),defaultSelectedKey:e.audioDeviceInfo?e.audioDeviceInfo.id:"",onChange:function(){var t,n=null!==(t=arguments.length<=2?void 0:arguments[2])&&void 0!==t?t:0;e.setAudioDeviceInfo(e.audioDeviceList[n]),e.deviceManager.selectMicrophone(e.audioDeviceList[n])}})))},jr={childrenGap:"3rem"},Ir=Object(p.D)({marginRight:"0.375rem",fontSize:"1.375rem"}),yr=Object(p.D)({fontWeight:600,fontSize:"0.875rem",height:"2.75rem",width:"100%",marginTop:"2.125rem",maxWidth:"18.75rem",minWidth:"12.5rem"}),wr=Object(p.D)({maxWidth:"46.875rem",width:"100%",height:"100%",selectors:{"@media (max-width: 750px)":{padding:"0.625rem",height:"100%"}}}),Dr=Object(p.D)({width:"100%",maxWidth:"18.75rem"}),Cr=Object(p.D)({height:"100%",width:"100%"}),xr=Object(p.D)({height:"100%",width:"100%",justifyContent:"space-evenly"}),kr=(Object(p.D)({minWidth:"12.5rem"}),Object(p.D)({boxSizing:"border-box",height:"2.5rem",width:"18.75rem",border:"1px solid #605e5c",borderRadius:"2px",backgroundColor:"#FFFFFF"})),Nr=Object(p.D)({fontSize:"0.875rem",fontWeight:600,lineHeight:"1.5rem","::-webkit-input-placeholder":{fontSize:"0.875rem",fontWeight:600},"::-moz-placeholder":{fontSize:"0.875rem",fontWeight:600},":-moz-placeholder":{fontSize:"0.875rem",fontWeight:600}}),Tr=Object(p.D)({boxSizing:"border-box",height:"2.5rem",width:"18.75rem",border:"1px solid #e81123",borderRadius:"2px",backgroundColor:"#FFFFFF",fontSize:"0.875rem"}),Rr=Object(p.D)({fontSize:"0.875rem",fontWeight:600,color:"rgb(50, 49, 48)",boxSizing:"border-box",boxShadow:"none",margin:0,display:"inline-block",padding:"5px 0px",overflowWrap:"break-word"}),Pr=Object(p.D)({width:"18.75rem",backgroundColor:"#FFFFFF",marginTop:"0.188rem",marginBottom:"0.188rem",marginLeft:"0.188rem",color:"#e81123",fontSize:".7375rem",fontWeight:"400"}),Ar={wrapper:{height:"2.3rem"},fieldGroup:{height:"2.3rem"}},Mr=function(e){return u.a.createElement("div",null,u.a.createElement("div",{className:Rr},"Name"),u.a.createElement(yt.a,{autoComplete:"off",inputClassName:Nr,ariaLabel:"Choose your name",borderless:!0,className:e.isEmpty?Tr:kr,onChange:function(t){e.setName(t.target.value),t.target.value?e.setEmptyWarning(!1):e.setEmptyWarning(!0)},id:"name",placeholder:"Enter your name",defaultValue:e.name,styles:Ar}),e.isEmpty&&u.a.createElement("div",{role:"alert",className:Pr}," ","Name cannot be empty"," "))},Lr=n(395),_r=Object(g.b)((function(e,t){return{deviceManager:e.devices.deviceManager,callAgent:e.calls.callAgent,group:e.calls.group,mic:e.controls.mic,screenWidth:t.screenWidth,audioDeviceInfo:e.devices.audioDeviceInfo,videoDeviceInfo:e.devices.videoDeviceInfo,videoDeviceList:e.devices.videoDeviceList,audioDeviceList:e.devices.audioDeviceList,cameraPermission:e.devices.cameraPermission,microphonePermission:e.devices.microphonePermission,joinGroup:function(){var t=Object(P.a)(R.a.mark((function t(n,r,a){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=n,!t.t0){t.next=4;break}return t.next=4,jt(n,{groupId:r},{videoOptions:{localVideoStreams:a?[a]:void 0},audioOptions:{muted:!e.controls.mic}});case 4:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),getToken:function(){var e=Object(P.a)(R.a.mark((function e(){var t,n,r,a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ut();case 2:return t=e.sent,n=t.token,r=t.user.communicationUserId,a=new pe.a({tokenRefresher:function(){return W.getRefreshedTokenForUser(r)},refreshProactively:!0,token:n}),e.abrupt("return",{tokenCredential:a,userId:r});case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),createCallAgent:function(){var t=Object(P.a)(R.a.mark((function t(n,r){var a,i;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(a=e.sdk.callClient)){t.next=3;break}throw new Error("CallClient is not initialized");case 3:return t.next=5,a.createCallAgent(n,{displayName:r});case 5:return i=t.sent,t.abrupt("return",i);case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}}),(function(e){return{setMic:function(t){return e(je(t))},setAudioDeviceInfo:function(t){return e(Ce(t))},setVideoDeviceInfo:function(t){return e(xe(t))},setupCallClient:function(t){return e(function(e){return function(){var t=Object(P.a)(R.a.mark((function t(n,r){var a,i;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!W.isOnIphoneAndNotSafari()&&!W.isUnsupportedBrowser()){t.next=3;break}return e(),t.abrupt("return");case 3:t.prev=3,Object(Re.b)("verbose"),a=new fe.CallClient,t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(3),e(),t.abrupt("return");case 12:if(a){t.next=14;break}return t.abrupt("return");case 14:return t.next=16,a.getDeviceManager();case 16:i=t.sent,n(Fe(a)),n(ye(i)),Et(i,n,r);case 20:case"end":return t.stop()}}),t,null,[[3,8]])})));return function(e,n){return t.apply(this,arguments)}}()}(t))},registerToCallEvents:function(){var t=Object(P.a)(R.a.mark((function t(n,r,a){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e(We(n)),e(ge(r)),e(Ot(n,r,a));case 3:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),setGroup:function(t){return e(function(e){return{type:"SET_GROUP",group:e}}(t))},updateDevices:function(){return e(function(){var e=Object(P.a)(R.a.mark((function e(t,n){var r,a,i,c;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n(),null!=(a=r.devices.deviceManager)){e.next=5;break}return console.error("no device manager available"),e.abrupt("return");case 5:return e.next=7,a.getCameras();case 7:return i=e.sent,t(Ne(i)),e.next=11,a.getMicrophones();case 11:c=e.sent,t(ke(c));case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())}}}))((function(e){var t=Object(l.useState)("user"+Math.ceil(1e3*Math.random())),n=Object(h.a)(t,2),r=n[0],a=n[1],i=Object(l.useState)(!1),c=Object(h.a)(i,2),o=c[0],s=c[1],d=e.groupId,m=e.setupCallClient,p=e.setGroup,f=e.unsupportedStateHandler;return Object(l.useEffect)((function(){m(f)}),[m,f]),u.a.createElement(E.a,{className:wr,horizontalAlign:"center",verticalAlign:"center"},e.deviceManager?u.a.createElement(E.a,{className:e.screenWidth>750?Cr:xr,horizontal:e.screenWidth>750,horizontalAlign:"center",verticalAlign:"center",tokens:e.screenWidth>750?jr:void 0},u.a.createElement(fr,{mic:e.mic,setMic:e.setMic,setLocalVideoStream:e.setLocalVideoStream,videoDeviceInfo:e.videoDeviceInfo,audioDeviceInfo:e.audioDeviceInfo,localVideoStream:e.localVideoStream,videoDeviceList:e.videoDeviceList,audioDeviceList:e.audioDeviceList}),u.a.createElement(E.a,{className:Dr},u.a.createElement(Mr,{setName:a,name:r,setEmptyWarning:s,isEmpty:o}),u.a.createElement("div",null,u.a.createElement(Sr,{videoDeviceList:e.videoDeviceList,audioDeviceList:e.audioDeviceList,audioDeviceInfo:e.audioDeviceInfo,videoDeviceInfo:e.videoDeviceInfo,setVideoDeviceInfo:e.setVideoDeviceInfo,setAudioDeviceInfo:e.setAudioDeviceInfo,deviceManager:e.deviceManager})),u.a.createElement("div",null,u.a.createElement(j.a,{className:yr,onClick:Object(P.a)(R.a.mark((function t(){var n,a,i,c;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r){t.next=4;break}s(!0),t.next=18;break;case 4:return s(!1),t.next=7,e.getToken();case 7:return n=t.sent,a=n.tokenCredential,i=n.userId,t.next=12,e.createCallAgent(a,r);case 12:return c=t.sent,e.registerToCallEvents(i,c,e.callEndedHandler),t.next=16,e.joinGroup(c,d);case 16:e.startCallHandler(),p(d);case 18:case"end":return t.stop()}}),t)})))},u.a.createElement(Lr.a,{className:Ir,size:"medium"}),"Start call")))):u.a.createElement(Xn.a,{label:"Initializing call client...",ariaLive:"assertive",labelPosition:"top"}))})),zr={childrenGap:44},Vr={childrenGap:12},Ur={childrenGap:24},Wr=Object(p.D)({width:330}),Fr=Object(p.D)({fontWeight:600,fontSize:"1.375rem"}),Hr=Object(p.D)({fontWeight:600,height:"2.5rem",width:"9.875rem",fontSize:"0.875rem",padding:0}),Gr=Object(p.D)({marginRight:"0.375rem",fontSize:"1.375rem"}),Br=Object(p.D)({color:"rgb(0,0,0)",fontSize:"0.875rem"}),Yr=Object(p.D)({fontSize:"0.875rem"}),Kr=function(e){var t=Object(l.useState)(!1),n=Object(h.a)(t,2),r=n[0],a=n[1],i=function(){var t=Object(P.a)(R.a.mark((function t(){return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r||(a(!0),e.rejoinHandler());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return u.a.createElement(E.a,{verticalAlign:"center",tokens:zr,className:Wr},u.a.createElement(E.a,{tokens:Ur},u.a.createElement("div",{tabIndex:0,className:Fr},"You left the chat"),u.a.createElement(E.a,{horizontal:!0,tokens:Vr},u.a.createElement(j.a,{disabled:r,className:Hr,onClick:Object(P.a)(R.a.mark((function e(){return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:case"end":return e.stop()}}),e)})))},u.a.createElement($n.a,{className:Gr,size:"medium"}),u.a.createElement("div",{className:Yr},r?"Rejoining...":"Rejoin chat")),u.a.createElement(zt.a,{className:Hr,onClick:e.homeHandler},u.a.createElement("div",{className:Yr}," ","Go to homepage")))))},Jr=function(e){return u.a.createElement(E.a,{verticalAlign:"center",tokens:zr,className:Wr},u.a.createElement(E.a,{tokens:Ur},u.a.createElement("div",{tabIndex:0,className:Fr},"You are no longer a participant for the chat thread."),u.a.createElement(E.a,{horizontal:!0,tokens:Vr},u.a.createElement(zt.a,{className:Hr,onClick:e.homeHandler},"Go to homepage"))),u.a.createElement("div",{className:Br},u.a.createElement("a",{href:"https://github.com/Azure/Communication/issues"},"Give Feedback"),"\xa0on this sample app on Github"))},Zr=n(443),Qr=n.n(Zr),Xr=Object(p.y)().palette,$r=Object(p.D)({width:"26.813rem",height:"20.125rem",selectors:{"@media (max-width: 53.438rem)":{display:"none"}}}),qr={childrenGap:55},ea={childrenGap:42},ta=(Object(p.D)({listStyleType:"none",paddingLeft:"0px",fontSize:"0.875rem"}),Object(p.D)({marginRight:7,color:Xr.themePrimary}),Object(p.D)({fontWeight:600,fontSize:"2.25rem",maxWidth:"23.188rem"})),na=Object(p.D)({marginRight:"0.375rem",fontSize:"1.375rem"}),ra=Object(p.D)({fontWeight:600,fontSize:"0.875rem",width:"fit-content",height:"2.5rem",borderRadius:3,selectors:{"@media (max-width: 53.438rem)":{padding:"0.625rem"}}}),aa=Object(p.D)({selectors:{"@media (max-width: 53.438rem)":{padding:"0.625"}}}),ia=(Object(p.D)({color:"#303030",opacity:.8,marginTop:"0.625rem",fontSize:"0.75rem",fontWeight:400}),Object(p.D)({fontSize:"0.875rem"})),ca={image:{height:"100%"},root:{}},oa=Object(g.b)((function(){return{createThreadHandler:function(){$e()}}}))((function(e){var t={src:Qr.a.toString()},n=Object(l.useState)(!1),r=Object(h.a)(n,2),a=r[0],i=r[1];return a?u.a.createElement(Xn.a,{label:"Creating a new chat thread...",ariaLive:"assertive",labelPosition:"top"}):u.a.createElement("div",null,u.a.createElement(E.a,{horizontal:!0,horizontalAlign:"center",verticalAlign:"center",tokens:qr},u.a.createElement(E.a,{className:aa,tokens:ea},u.a.createElement("div",{tabIndex:0,className:ta},"Welcome to ConnectBox!"),u.a.createElement(j.a,{id:"startChat",role:"main","aria-label":"Start chat",className:ra,onClick:function(){e.createThreadHandler(),i(!0)}},u.a.createElement($n.a,{className:na,size:"medium"}),u.a.createElement("div",{className:ia},"Start connecting"))),u.a.createElement(nr.a,Object.assign({styles:ca,alt:"Welcome to the Azure Communication Services Chat sample app",className:$r},t))))})),sa={chatClient:void 0,user:{identity:"",token:"",displayName:"",memberRole:""},users:{}},la={receipts:[]},ua=n(67),da={messages:[],typingNotifications:{},typingUsers:[],failedMessages:[]},ma={topic:"c774da81-94d5-4652-85c7-6ed0e8dc67e6",threadId:void 0},ha={threadMembers:[],error:!1,isRemoved:!1},pa={deviceManager:void 0,audioDeviceInfo:void 0,videoDeviceInfo:void 0,audioDeviceList:[],videoDeviceList:[],cameraPermission:void 0,microphonePermission:void 0},fa={localVideoRendererIsBusy:!1,screenShareStreams:[]},ga={mic:!1,localVideo:!1,shareScreen:!1},va={displayName:""},ba={callAgent:void 0,call:void 0,callState:"None",incomingCallEndReason:void 0,groupCallEndReason:void 0,remoteParticipants:[],dominantParticipants:[],group:"",attempts:0},Ea=Object(v.c)({chat:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:da,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGES":return Object(O.a)(Object(O.a)({},e),{},{messages:Object($.a)(t.messages)});case"SET_TYPING_NOTIFICATIONS":return Object(O.a)(Object(O.a)({},e),{},{typingNotifications:Object(O.a)(Object(O.a)({},e.typingNotifications),{},Object(ua.a)({},t.id,t.typingNotification))});case"SET_TYPING_USERS":return Object(O.a)(Object(O.a)({},e),{},{typingUsers:Object($.a)(t.typingUsers)});case"SET_FAILED_MESSAGES":return Object(O.a)(Object(O.a)({},e),{},{failedMessages:Object($.a)(t.failedMessages)});default:return e}},contosoClient:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:sa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CHAT_CLIENT":return Object(O.a)(Object(O.a)({},e),{},{chatClient:t.chatClient});case"SET_CURRENT_USER":return Object(O.a)(Object(O.a)({},e),{},{user:{identity:t.identity,token:t.token,displayName:t.displayName,memberRole:t.memberRole}});case"SET_USERS":return Object(O.a)(Object(O.a)({},e),{},{users:Object.assign({},t.users)});default:return e}},conversations:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:la,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_RECEIPTS":return Object(O.a)(Object(O.a)({},e),{},{receipts:Object($.a)(t.receipts)});default:return e}},thread:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ma,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_THREAD_TOPIC_NAME":return Object(O.a)(Object(O.a)({},e),{},{topic:t.topicName});case"SET_THREAD_ID":return Object(O.a)(Object(O.a)({},e),{},{threadId:t.threadId});default:return e}},threadMembers:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ha,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_THREAD_MEMBERS":return Object(O.a)(Object(O.a)({},e),{},{threadMembers:Object($.a)(t.threadMembers)});case"SET_THREAD_MEMBERS_ERROR":return Object(O.a)(Object(O.a)({},e),{},{error:!0});case"SET_REMOVED_FROM_THREAD":return Object(O.a)(Object(O.a)({},e),{},{isRemoved:t.isRemoved});default:return e}},calls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ba,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CALL_AGENT":return Object(O.a)(Object(O.a)({},e),{},{callAgent:t.callAgent});case"CALL_ADDED":return Object(O.a)(Object(O.a)({},e),{},{call:t.call});case"CALL_REMOVED":return Object(O.a)(Object(O.a)({},e),{},{call:void 0,remoteParticipants:[],incomingCallEndReason:t.incomingCallEndReason,groupCallEndReason:t.groupCallEndReason});case"SET_CALL_STATE":return Object(O.a)(Object(O.a)({},e),{},{callState:t.callState});case"SET_DOMINANT_PARTICIPANTS":return Object(O.a)(Object(O.a)({},e),{},{dominantParticipants:t.dominantParticipants});case"SET_PARTICIPANTS":return Object(O.a)(Object(O.a)({},e),{},{remoteParticipants:t.remoteParticipants});case"SET_GROUP":return Object(O.a)(Object(O.a)({},e),{},{group:t.group});default:return e}},devices:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DEVICE_MANAGER":return Object(O.a)(Object(O.a)({},e),{},{deviceManager:t.deviceManager});case"SET_VIDEO_DEVICE_INFO":return Object(O.a)(Object(O.a)({},e),{},{videoDeviceInfo:t.videoDeviceInfo});case"SET_AUDIO_DEVICE_INFO":return Object(O.a)(Object(O.a)({},e),{},{audioDeviceInfo:t.audioDeviceInfo});case"SET_VIDEO_DEVICE_LIST":return Object(O.a)(Object(O.a)({},e),{},{videoDeviceList:t.videoDeviceList});case"SET_AUDIO_DEVICE_LIST":return Object(O.a)(Object(O.a)({},e),{},{audioDeviceList:t.audioDeviceList});case"SET_CAMERA_PERMISSION":return Object(O.a)(Object(O.a)({},e),{},{cameraPermission:t.cameraPermission});case"SET_MICROPHONE_PERMISSION":return Object(O.a)(Object(O.a)({},e),{},{microphonePermission:t.microphonePermission});default:return e}},streams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_SCREENSHARE_STREAM":var n={stream:t.stream,user:t.user};return Object(O.a)(Object(O.a)({},e),{},{screenShareStreams:[].concat(Object($.a)(e.screenShareStreams),[n])});case"REMOVE_SCREENSHARE_STREAM":var r=e.screenShareStreams.filter((function(e){return e.stream!==t.stream&&e.user!==t.user}));return Object(O.a)(Object(O.a)({},e),{},{screenShareStreams:r});default:return e}},controls:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ga,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MIC":return Object(O.a)(Object(O.a)({},e),{},{mic:t.mic});case"SET_SHARE_SCREEN":return Object(O.a)(Object(O.a)({},e),{},{shareScreen:t.shareScreen});default:return e}},sdk:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:va,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USERID":return Object(O.a)(Object(O.a)({},e),{},{userId:t.userId});case"SET_CALL_CLIENT":return Object(O.a)(Object(O.a)({},e),{},{callClient:t.callClient});case"SET_DISPLAY_NAME":return Object(O.a)(Object(O.a)({},e),{},{displayName:t.displayName});default:return e}}}),Oa=n(1186),Sa=n(1182),ja=n(1188),Ia=n(1183),ya=n(396),wa=n(397),Da=n(398),Ca=n(399),xa=n(400),ka=Object(p.y)().palette,Na=Object(p.D)({height:"3.75rem",padding:"0 0.8125rem",display:"inline-block",borderRadius:7,overflow:"hidden"}),Ta=Object(p.D)({backgroundColor:ka.white,width:"2rem",height:"3.75rem",border:"0.125rem",borderRadius:2,marginRight:"0.4375rem",color:ka.neutralSecondary}),Ra=Object(p.D)(Ta,{color:ka.neutralLight}),Pa=Object(p.D)({backgroundColor:"#d74654",width:"6.5625rem",height:"2.1875rem",border:"0.125rem",marginRight:"0.75rem",marginLeft:"0.75rem",borderRadius:2,color:ka.white,selectors:{":focus":{color:ka.white},":hover":{color:ka.white},":active":{color:ka.white}}}),Aa=Object(p.D)({color:ka.white,padding:"0.3125rem",fontSize:"0.875rem",lineHeight:"3.75rem"}),Ma=Object(p.D)({width:"100%"}),La=function(e){var t="Denied"!==e.cameraPermission&&e.cameraActive,n="Denied"===e.cameraPermission,r="Denied"!==e.cameraPermission?e.onCameraChange:void 0,a="Denied"!==e.microphonePermission&&e.micActive,i="Denied"===e.microphonePermission,c="Denied"!==e.microphonePermission?e.onMicChange:void 0,o=!!e.activeScreenShareStream;return l.createElement(E.a,{className:Na},l.createElement(Ia.a,{onKeyDownCapture:function(t){13===t.keyCode&&e.localVideoRendererIsBusy&&t.preventDefault()},disabled:n,onClick:r,className:Ta},l.createElement("div",{className:Ma},t?l.createElement(ar.a,{size:"medium"}):l.createElement(ya.a,{size:"medium"}))),l.createElement(Ia.a,{onClick:c,disabled:i,className:Ta},l.createElement("div",{className:Ma},a?l.createElement(ir.a,{size:"medium"}):l.createElement(wa.a,{size:"medium"}))),e.isLocalScreenShareSupportedInBrowser()&&l.createElement(Ia.a,{disabled:o,onClick:e.onScreenShareChange,className:o?Ra:Ta},l.createElement("div",{className:Ma},e.screenShareActive?l.createElement(Da.a,{size:"medium"}):l.createElement(Ca.a,{size:"medium"}))),l.createElement(Ia.a,{onClick:e.onEndCallClick,className:e.compressedMode?Ta:Pa},l.createElement("div",{className:Ma},l.createElement(xa.a,{size:"medium"}),!e.compressedMode&&l.createElement("span",{className:Aa},"Leave"))))},_a=n(1172),za=n(8),Va=n(431),Ua=n(1187),Wa={root:{minWidth:0,padding:"0 0.25rem",alignSelf:"stretch",height:"auto",width:"12.5rem"},primaryText:{color:"#000000"}},Fa={root:{minWidth:0,padding:"0 0.25rem",alignSelf:"stretch",height:"auto"}},Ha=Object(p.D)({maxHeight:"100%",overflow:"auto",paddingLeft:"1.125rem",paddingRight:"1.125rem"}),Ga=Object(p.D)({margin:"0.4375rem",fontSize:"1rem"}),Ba={childrenGap:"0.625rem",padding:"0.625rem"},Ya=function(e){return l.createElement(l.Fragment,null,l.createElement(_a.a,{text:e.name,styles:Wa,size:za.c.size32,presence:"Connected"===e.state?za.b.online:za.b.offline}),e.isSpeaking?l.createElement(ir.a,{size:"medium"}):l.createElement(wa.a,{size:"medium"}),e.isScreenSharing&&l.createElement(Va.a,{className:Ga,iconName:"ScreenCast"}))},Ka=function(e){return l.createElement(Sn.a,{role:"menuitem",title:"More options",styles:Fa,menuIconProps:{iconName:"More"},menuProps:{items:e}})},Ja=Object(g.b)((function(e){var t;return{userId:e.sdk.userId,displayName:null===(t=e.calls.callAgent)||void 0===t?void 0:t.displayName,call:e.calls.call,callState:e.calls.callState,remoteParticipants:e.calls.remoteParticipants,screenShareStreams:e.streams.screenShareStreams}}))((function(e){var t=e.screenShareStreams&&1===e.screenShareStreams.length,n=e.screenShareStreams[0],r=e.remoteParticipants.map((function(e){var r,a=!!t&&n.user===e;return{key:W.getId(e.identifier),name:null!==(r=e.displayName)&&void 0!==r?r:W.getId(e.identifier),participant:e,state:e.state,isScreenSharing:a,isSpeaking:e.isSpeaking}}));return r.push({key:"".concat(e.userId," (You)"),name:"".concat(e.displayName," (You)"),participant:void 0,state:"Connected",isScreenSharing:!!t&&W.getId(n.user.identifier)===e.userId,isSpeaking:!e.call.isMuted}),l.createElement(E.a,{className:Ha,tokens:Ba},function(e){return e.map((function(e,t){return l.createElement(Ua.a,{key:t,items:[e],role:"menubar",vertical:!1,onRenderOverflowButton:Ka,onRenderItem:Ya})}))}(r))})),Za=Object(p.y)().palette,Qa={root:{height:"100%",overflowY:"auto"}},Xa={root:{marginBottom:"1.25rem"}},$a={childrenGap:"0.3125rem"},qa={field:{color:Za.neutralSecondary,padding:0},root:{marginLeft:"1rem",marginRight:"1rem"},fieldGroup:{border:"none"}},ei=Object(p.D)({height:"4.3125rem"}),ti=Object(p.D)({fontSize:"1.375rem",fontWeight:600,width:"69px",float:"left",margin:"20px"}),ni=Object(p.D)({fontWeight:600,fontSize:"1rem",marginLeft:"1rem",marginRight:"1rem"}),ri=Object(p.D)({fontWeight:600,fontSize:"0.875rem",height:"2.5rem",marginLeft:"1rem",marginRight:"1rem",width:"90%"}),ai=Object(p.D)({marginRight:"0.5em"}),ii=Object(p.D)({marginLeft:"1.25rem",width:"15.375rem"}),ci=function(){document.getElementById("inputText").select(),document.execCommand("copy")},oi=function(){return u.a.createElement(E.a,{styles:Xa,tokens:$a},u.a.createElement(ja.a,null),u.a.createElement("div",{className:ni},"Invite people to join"),u.a.createElement(yt.a,{styles:qa,id:"inputText",type:"text",value:"".concat(document.baseURI)}),u.a.createElement(j.a,{className:ri,onClick:ci},u.a.createElement(I.a,{iconName:"Copy",className:ai}),"Copy join info"))};!function(e){e.None="none",e.People="People",e.Settings="Settings"}(Bn||(Bn={}));var si=function(e){return u.a.createElement(E.a,{styles:Qa},u.a.createElement(E.a.Item,{className:ei},u.a.createElement("div",{className:ti},e.selectedPane)),e.selectedPane===Bn.People&&u.a.createElement(E.a.Item,{styles:Qa},u.a.createElement(Ja,null)),e.selectedPane===Bn.People&&u.a.createElement(E.a.Item,null,u.a.createElement(oi,null)),e.selectedPane===Bn.Settings&&u.a.createElement(E.a.Item,null,u.a.createElement("div",{className:ii},u.a.createElement(Sr,{videoDeviceList:e.videoDeviceList,audioDeviceList:e.audioDeviceList,audioDeviceInfo:e.audioDeviceInfo,videoDeviceInfo:e.videoDeviceInfo,setVideoDeviceInfo:e.setVideoDeviceInfo,setAudioDeviceInfo:e.setAudioDeviceInfo,deviceManager:e.deviceManager}))))},li=Object(p.y)().palette,ui={linkIsSelected:{padding:0,marginRight:0,height:"100%",color:li.themePrimary,selectors:{":hover":{color:li.themePrimary}}},link:{padding:0,marginRight:0,height:"3.75rem"},root:{width:"5.25rem",height:"3.75rem",display:"inline-block",verticalAlign:"top"}},di=(Object(p.D)({display:"inline-block"}),Object(p.D)({width:"100%",height:"3.875rem",padding:"0.0625rem 0",boxShadow:"rgba(0, 0, 0, 0.133) 0px 1.6px 3.6px 0px, rgba(0, 0, 0, 0.11) 0px 0.3px 0.9px 0px",overflow:"hidden",flexDirection:"row",justifyContent:"flex-end",alignItems:"center",marginBottom:2})),mi=Object(p.D)(di,{justifyContent:"center"}),hi=Object(p.D)({display:"inline-block",padding:"0 1rem",height:"1.875rem"}),pi=Object(p.D)({padding:"0 0.8125rem"}),fi={root:{color:li.neutralLight,width:"0.0625rem"}},gi=Object(g.b)((function(e,t){return{actionable:e.calls.callState===Ve.INCOMING||e.calls.callState===Ve.RINGING||e.calls.callState===Ve.CONNECTING||e.calls.callState===Ve.CONNECTED,mic:e.controls.mic,call:e.calls.call,shareScreen:e.controls.shareScreen,endCall:function(){e.calls.call&&St(e.calls.call,{forEveryone:!1}),t.endCallHandler()},videoDeviceInfo:e.devices.videoDeviceInfo,screenWidth:t.screenWidth,screenShareStreams:e.streams.screenShareStreams,localVideoRendererIsBusy:e.streams.localVideoRendererIsBusy,cameraPermission:e.devices.cameraPermission,microphonePermission:e.devices.microphonePermission}}),(function(e){return{setMic:function(t){return e(ft(t))},setScreenShare:function(t){return e((n=t,function(){var e=Object(P.a)(R.a.mark((function e(t,r){var a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(a=r())&&void 0!==a.calls.call){e.next=4;break}return console.error("state or state.controls.shareScreen is null"),e.abrupt("return");case 4:if(e.prev=4,a.controls.shareScreen){e.next=10;break}return e.next=8,a.calls.call.startScreenSharing();case 8:e.next=12;break;case 10:return e.next=12,a.calls.call.stopScreenSharing();case 12:t(Ie(n)),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(4),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[4,15]])})));return function(t,n){return e.apply(this,arguments)}}()));var n},isLocalScreenShareSupportedInBrowser:function(){return!W.isMobileSession()&&(/chrome/i.test(navigator.userAgent.toLowerCase())||/safari/i.test(navigator.userAgent.toLowerCase()))}}}))((function(e){var t,n=function(){var t=Object(P.a)(R.a.mark((function t(){var n;return R.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.localVideoStream){t.next=6;break}return t.next=3,e.call.stopVideo(e.localVideoStream);case 3:e.setLocalVideoStream(void 0),t.next=11;break;case 6:if(!e.videoDeviceInfo){t.next=11;break}return n=new fe.LocalVideoStream(e.videoDeviceInfo),e.setLocalVideoStream(n),t.next=11,e.call.startVideo(n);case 11:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(l.useEffect)((function(){e.call&&0===e.call.localVideoStreams.length&&e.localVideoStream&&e.call.startVideo(e.localVideoStream)}),[e.call,e.localVideoStream]),u.a.createElement(E.a,{id:"header",className:e.screenWidth>Ve.MINI_HEADER_WINDOW_WIDTH?di:mi},u.a.createElement(Lt.a,{onKeyDownCapture:function(e){e.target.id===Bn.People&&39===e.keyCode&&e.preventDefault()},getTabId:function(e){return e},onLinkClick:function(t){var n,r;t&&(t.props.itemKey===Bn.Settings&&(n=e.selectedPane,r=e.setSelectedPane,n!==Bn.Settings?r(Bn.Settings):r(Bn.None)),t.props.itemKey===Bn.People&&function(e,t){e!==Bn.People?t(Bn.People):t(Bn.None)}(e.selectedPane,e.setSelectedPane))},styles:ui,initialSelectedKey:Bn.None,selectedKey:e.selectedPane},u.a.createElement(_t.a,{itemKey:Bn.Settings,onRenderItemLink:function(){return u.a.createElement(Ut.a,{outline:e.selectedPane!==Bn.Settings,size:"medium",className:pi})}}),u.a.createElement(_t.a,{itemKey:Bn.People,onRenderItemLink:function(){return u.a.createElement(Vt.a,{outline:e.selectedPane!==Bn.People,size:"medium",className:pi})}}),u.a.createElement(_t.a,{itemKey:Bn.None})),e.screenWidth>Ve.MINI_HEADER_WINDOW_WIDTH&&u.a.createElement("div",{className:hi},u.a.createElement(ja.a,{styles:fi,vertical:!0})),u.a.createElement(La,{micActive:e.mic,onMicChange:function(){e.setMic(!e.mic)},cameraActive:void 0!==e.localVideoStream,onCameraChange:n,screenShareActive:e.shareScreen,activeScreenShareStream:null!==(t=e.screenShareStreams[0])&&void 0!==t?t:void 0,onScreenShareChange:function(){e.setScreenShare(!e.shareScreen)},onEndCallClick:function(){e.localVideo&&n(),e.endCall()},cameraPermission:e.cameraPermission,microphonePermission:e.microphonePermission,localVideoRendererIsBusy:e.localVideoRendererIsBusy,compressedMode:e.screenWidth<=Ve.MINI_HEADER_WINDOW_WIDTH,isLocalScreenShareSupportedInBrowser:e.isLocalScreenShareSupportedInBrowser}))})),vi=Object(p.y)().palette,bi=Object(p.D)({padding:"0.4375rem",display:"flex",alignItems:"center",justifyContent:"center",border:0,borderRight:"1px solid rgba(0,0,0,0.05)",borderBottom:"1px solid rgba(0,0,0,0.05)"}),Ei=Object(p.D)({padding:"0.4375rem",width:"100px",minWidth:"100px",height:"100px",display:"flex",alignItems:"center",justifyContent:"center",border:0,borderRight:"1px solid rgba(0,0,0,0.05)",borderBottom:"1px solid rgba(0,0,0,0.05)"}),Oi=Object(p.D)({height:"100%",background:vi.neutralLighterAlt,display:"grid",overflow:"hidden"}),Si=Object(p.D)({height:"8.438rem",overflowX:"auto",overflowY:"hidden"}),ji=Object(p.y)().palette,Ii=Object(p.D)({backgroundColor:ji.neutralSecondary,bottom:"5%",height:"1.75rem",boxShadow:"0 0 1px 0 rgba(0,0,0,.16)",color:ji.neutralLighter,fontSize:"1.25rem",lineHeight:"1.0625rem",textAlign:"left",left:"2%",overflow:"hidden",position:"absolute",padding:"0.25rem",whiteSpace:"nowrap",maxWidth:"95%",borderRadius:4,textOverflow:"ellipsis"}),yi=Object(p.D)({position:"relative",height:"100%",width:"100%",background:"transparent"}),wi=Object(p.D)(yi,{width:"100%",height:"100%"}),Di=function(e){var t=Object(l.useRef)(),n=Object(l.useState)(!1),r=Object(h.a)(n,2),a=r[0],i=r[1],c={src:or.a.toString(),imageFit:tr.b.contain,styles:{root:{width:"100%",height:"100%",display:a?"none":"block"}}},o=e.stream,s=e.label;return Object(l.useEffect)((function(){return Object(P.a)(R.a.mark((function e(){var n,r,a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=9;break}return n=new fe.VideoStreamRenderer(o),e.next=4,n.createView({scalingMode:"Crop",isMirrored:!0});case 4:t.current=e.sent,(r=document.getElementById(Ve.LOCAL_VIDEO_PREVIEW_ID))&&0===r.childElementCount&&(r.appendChild(t.current.target),i(!0)),e.next=10;break;case 9:t&&(null===(a=t.current)||void 0===a||a.dispose(),i(!1));case 10:case"end":return e.stop()}}),e)})))(),function(){var e;t&&(null===(e=t.current)||void 0===e||e.dispose(),t.current=void 0,i(!1))}}),[o]),u.a.createElement("div",{className:yi},u.a.createElement("div",{style:{display:a?"block":"none"},className:wi,id:Ve.LOCAL_VIDEO_PREVIEW_ID}),u.a.createElement(nr.a,c),u.a.createElement(Sa.a,{className:Ii},s))},Ci=n(94),xi=function(e){var t=Object(l.useRef)(),n=e.stream?W.getStreamId(e.label,e.stream):"".concat(e.label," - no stream"),r=Object(l.useState)(!1),a=Object(h.a)(r,2),i=a[0],c=a[1],o=Object(l.useState)(!1),s=Object(h.a)(o,2),d=s[0],m=s[1],p={src:or.a.toString(),imageFit:tr.b.contain,styles:{root:{width:"100%",height:"100%",display:i?"none":"block"}}},f=e.label,g=e.stream,v=e.isParticipantStreamSelected,b=Object(l.useCallback)(Object(P.a)(R.a.mark((function e(){var r,a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=document.getElementById(n))&&g&&g.isAvailable&&v)){e.next=14;break}if(!i){e.next=4;break}return e.abrupt("return");case 4:return c(!0),m(!0),a=new fe.VideoStreamRenderer(g),e.next=9,a.createView({scalingMode:"Crop"});case 9:t.current=e.sent,m(!1),r&&0===r.childElementCount&&r.appendChild(t.current.target),e.next=16;break;case 14:c(!1),t.current&&(t.current.dispose(),t.current=void 0);case 16:case"end":return e.stop()}}),e)}))),[g,n,v,i,m,c]);return Object(l.useEffect)((function(){g&&(g.on("isAvailableChanged",b),g.isAvailable&&b())}),[g,v,b]),u.a.createElement("div",{className:yi},u.a.createElement("div",{style:{display:i?"block":"none"},className:yi,id:n},d&&u.a.createElement(Xn.a,{style:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},label:"Rendering stream...",size:Ci.a.xSmall})),u.a.createElement(nr.a,p),u.a.createElement(Sa.a,{className:Ii},f))},ki=Object(g.b)((function(e){var t;return{userId:e.sdk.userId,displayName:null===(t=e.calls.callAgent)||void 0===t?void 0:t.displayName,remoteParticipants:e.calls.remoteParticipants,dominantParticipants:e.calls.dominantParticipants}}))((function(e){var t=Object(l.useState)(1),n=Object(h.a)(t,2),r=n[0],a=n[1],i=Object(l.useState)(1),c=Object(h.a)(i,2),o=c[0],s=c[1],d=[1,1,2,2,2,2,3,3,3,3],m=[1,2,2,2,3,3,3,3,3,4];(Ve.DOMINANT_PARTICIPANTS_COUNT<0||Ve.DOMINANT_PARTICIPANTS_COUNT>d.length-1)&&console.warn("Please use a value for dominant participants between 0 <= x <= ".concat(d.length-1));var p=Math.min(Ve.DOMINANT_PARTICIPANTS_COUNT,d.length-1),f=Object(l.useMemo)((function(){return t=e.remoteParticipants.length,n=0,r=p,Math.min(Math.max(t,n),r);var t,n,r}),[p,e.remoteParticipants.length]);if(m[f]!==r){if(f>m.length-1)throw new Error("attempting to set up a number of columns in the gallery for an unexpected number of participants ".concat(f));a(m[f])}if(d[f]!==o){if(f>d.length-1)throw new Error("attempting to set up a number of rows in the gallery for an expected number of participants ".concat(f));s(d[f])}var g=e.remoteParticipants.sort((function(t,n){var r=e.dominantParticipants.filter((function(e){return e.participantId===W.getId(t.identifier)})).length>0,a=e.dominantParticipants.filter((function(e){return e.participantId===W.getId(n.identifier)})).length>0;return r&&!a?-1:!r&&a?1:0})),v=g.slice(0,p),b=g.slice(p),O=b.length>0;return u.a.createElement(E.a,{style:{height:"100%"}},u.a.createElement("div",{id:"video-gallery",className:Oi,style:{gridTemplateRows:"repeat(".concat(o,", minmax(0, 1fr))"),gridTemplateColumns:"repeat(".concat(r,", 1fr)")}},function(t,n){var r=t.map((function(t){var n;return u.a.createElement("div",{key:"".concat(W.getId(t.identifier),"-tile"),className:bi},u.a.createElement(xi,{key:W.getId(t.identifier),stream:t.videoStreams[0],isParticipantStreamSelected:e.dominantParticipants.filter((function(e){return e.participantId===W.getId(t.identifier)})).length>0,label:null!==(n=t.displayName)&&void 0!==n?n:W.getId(t.identifier)}))})),a=u.a.createElement("div",{key:"localParticipantTile",className:bi},u.a.createElement(Di,{label:n,stream:e.localVideoStream}));return r.unshift(a),r}(v,e.displayName)),O&&u.a.createElement(E.a,{horizontal:!0,className:Si},b.map((function(e){var t;return u.a.createElement("div",{key:"".concat(W.getId(e.identifier),"-tile"),className:Ei},u.a.createElement(xi,{key:W.getId(e.identifier),stream:e.videoStreams[0],isParticipantStreamSelected:!1,label:null!==(t=e.displayName)&&void 0!==t?t:W.getId(e.identifier)}))}))))})),Ni=Object(p.y)().palette,Ti=Object(p.D)({padding:"0.5em",borderRight:"1px solid rgba(0,0,0,0.05)",height:"100%",width:"100%",background:Ni.neutralLighterAlt}),Ri=Object(p.D)({display:"none",borderRight:"1px solid rgba(0,0,0,0.05)",height:"100%",width:"100%",background:Ni.neutralLighterAlt}),Pi=Object(p.D)({height:"100%",display:"flex",justifyContent:"center"}),Ai=function(e){var t,n=Object(l.useState)(!0),r=Object(h.a)(n,2),a=r[0],i=r[1],c=Object(l.useRef)(),o=e.activeScreenShareStream,s=Object(l.useCallback)(Object(P.a)(R.a.mark((function e(){var t,n,r,a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o||!o.stream){e.next=10;break}return t=o.stream,n=new fe.VideoStreamRenderer(t),e.next=5,n.createView({scalingMode:"Fit"});case 5:c.current=e.sent,(r=document.getElementById("fullScreenStreamMediaId"))&&0===r.childElementCount&&(i(!1),r.appendChild(c.current.target)),e.next=11;break;case 10:c&&(null===(a=c.current)||void 0===a||a.dispose());case 11:case"end":return e.stop()}}),e)}))),[o]);Object(l.useEffect)((function(){s()}),[s]);var d=null!==(t=e.activeScreenShareStream.user.displayName)&&void 0!==t?t:W.getId(e.activeScreenShareStream.user.identifier);return u.a.createElement(u.a.Fragment,null,a&&u.a.createElement("div",{className:Pi},u.a.createElement(Xn.a,{label:"Loading ".concat(d,"'s screen"),size:Ci.a.xSmall})),u.a.createElement("div",{id:"fullScreenStreamMediaId",className:a?Ri:Ti}))},Mi=Object(p.y)().palette,Li={root:{width:"100%"}},_i={root:{height:"100%",minHeight:"9.375rem",width:"100%"}},zi={root:{width:"17.875rem"}},Vi={root:{background:Mi.white,marginTop:"4rem"}},Ui={root:{border:"solid 1px ".concat(Mi.neutralLighterAlt),height:"100%",display:"none"}},Wi={root:{border:"solid 1px ".concat(Mi.neutralLighterAlt),height:"calc(100% - 3px)",display:"initial",width:"100%"}},Fi={root:{height:"100%",display:"flex",justifyContent:"center",alignItems:"center",width:"100%"}},Hi=Object(g.b)((function(e,t){return{userId:e.sdk.userId,callAgent:e.calls.callAgent,deviceManager:e.devices.deviceManager,group:e.calls.group,screenWidth:t.screenWidth,call:e.calls.call,shareScreen:e.controls.shareScreen,mic:e.controls.mic,groupCallEndReason:e.calls.groupCallEndReason,isGroup:function(){return e.calls.call&&"Incoming"!==e.calls.call.direction&&!!e.calls.group},remoteParticipants:e.calls.remoteParticipants,callState:e.calls.callState,localVideo:e.controls.localVideo,screenShareStreams:e.streams.screenShareStreams,videoDeviceInfo:e.devices.videoDeviceInfo,audioDeviceInfo:e.devices.audioDeviceInfo,videoDeviceList:e.devices.videoDeviceList,audioDeviceList:e.devices.audioDeviceList,cameraPermission:e.devices.cameraPermission,microphonePermission:e.devices.microphonePermission}}),(function(e){return{mute:function(){return e(ft(!1))},setAudioDeviceInfo:function(t){e(Ce(t))},setVideoDeviceInfo:function(t){e(xe(t))}}}))((function(e){var t=Object(l.useState)(Bn.None),n=Object(h.a)(t,2),r=n[0],a=n[1],i=e.screenShareStreams&&1===e.screenShareStreams.length;return u.a.createElement(E.a,{horizontalAlign:"center",verticalAlign:"center",styles:_i},u.a.createElement(E.a.Item,{styles:Li},u.a.createElement(gi,{selectedPane:r,setSelectedPane:a,endCallHandler:function(){e.endCallHandler()},screenWidth:e.screenWidth,localVideoStream:e.localVideoStream,setLocalVideoStream:e.setLocalVideoStream})),u.a.createElement(E.a.Item,{styles:_i},e.shareScreen?u.a.createElement(E.a,{horizontal:!0,styles:_i},u.a.createElement(E.a.Item,{styles:Fi},u.a.createElement(Sa.a,null,"Your screen is being shared")),r!==Bn.None&&(window.innerWidth>Ve.MINI_HEADER_WINDOW_WIDTH?u.a.createElement(E.a.Item,{disableShrink:!0,styles:zi},u.a.createElement(si,Object.assign({},e,{selectedPane:r,setSelectedPane:a}))):u.a.createElement(Oa.a,{styles:Vi},u.a.createElement(si,Object.assign({},e,{selectedPane:r,setSelectedPane:a}))))):e.callState===Ve.CONNECTED&&u.a.createElement(E.a,{horizontal:!0,styles:_i},u.a.createElement(E.a.Item,{grow:!0,styles:i?Wi:Ui},i&&u.a.createElement(Ai,{activeScreenShareStream:e.screenShareStreams[0]})),u.a.createElement(E.a.Item,{grow:!0,styles:i?Ui:Wi},u.a.createElement(ki,{localVideoStream:e.localVideoStream})),r!==Bn.None&&(window.innerWidth>Ve.MINI_HEADER_WINDOW_WIDTH?u.a.createElement(E.a.Item,{disableShrink:!0,styles:zi},u.a.createElement(si,Object.assign({},e,{selectedPane:r,setSelectedPane:a}))):u.a.createElement(Oa.a,{styles:Vi},u.a.createElement(si,Object.assign({},e,{selectedPane:r,setSelectedPane:a})))))))})),Gi={childrenGap:"0.25rem"},Bi={childrenGap:"0.75rem"},Yi={childrenGap:"1.5rem"},Ki=Object(p.D)({width:"20.625rem"}),Ji=Object(p.D)({fontSize:"1.375rem",fontWeight:600}),Zi=Object(p.D)({fontWeight:600,height:"2.5rem",width:"9.875rem",fontSize:"0.875rem",padding:0}),Qi=Object(p.D)({marginRight:"0.375rem",fontSize:"1.375rem"}),Xi=(Object(p.D)({color:"rgb(0,0,0)",fontSize:"0.875 rem"}),function(e){return u.a.createElement(E.a,{verticalAlign:"center",tokens:Gi,className:Ki},u.a.createElement(E.a,{tokens:Yi},u.a.createElement("div",{className:Ji},e.message),u.a.createElement(E.a,{horizontal:!0,tokens:Bi},u.a.createElement(j.a,{className:Zi,onClick:e.rejoinHandler},u.a.createElement(Lr.a,{className:Qi,size:"medium"}),"Rejoin call"),u.a.createElement(zt.a,{className:Zi,onClick:e.homeHandler},"Go to chatpage"))))});console.info("Azure Communication Services chat sample using @azure/communication-chat : ".concat(n(833).dependencies["@azure/communication-chat"])),console.info("Build Date : ".concat("10/7/2021, 7:52:16 pm")),Object(p.B)({}),Object(f.a)();var $i=Object(v.d)(Ea,Object(v.a)(b.a)),qi=function(){var e=Object(l.useState)("home"),t=Object(h.a)(e,2),n=t[0],r=t[1],a=Object(l.useState)(),i=Object(h.a)(a,2),c=(i[0],i[1]),o=Object(l.useState)(0),s=Object(h.a)(o,2),d=s[0],m=s[1],p=Object(l.useState)(void 0),f=Object(h.a)(p,2),v=f[0],b=f[1],E=Object(l.useCallback)((function(){return r("unsupported")}),[]);Object(l.useEffect)((function(){var e=function(){var e="undefined"!==typeof window?window.innerWidth:0;m(e)};return e(),window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]);return L()&&"home"===n&&r("configuration"),u.a.createElement(g.a,{store:$i},"home"===n?u.a.createElement(oa,null):"configuration"===n?u.a.createElement(er,{joinChatHandler:function(){return r("chat")}}):"chat"===n?u.a.createElement(Qn,{removedFromThreadHandler:function(){return r("removedFromThread")},leaveChatHandler:function(){return r("end")},startCallHandler:function(){window.history.pushState({},document.title,window.location.href+"&groupId=c07ff9d0-e09a-11eb-a078-25f7f03a6567"),r("callConfiguration")}}):"callConfiguration"===n?u.a.createElement(_r,{startCallHandler:function(){return r("call")},unsupportedStateHandler:E,callEndedHandler:function(e){c(e),r("error")},groupId:"c07ff9d0-e09a-11eb-a078-25f7f03a6567",screenWidth:d,localVideoStream:v,setLocalVideoStream:b}):"call"===n?u.a.createElement(Hi,{endCallHandler:function(){return r("endCall")},groupId:"c07ff9d0-e09a-11eb-a078-25f7f03a6567",screenWidth:d,localVideoStream:v,setLocalVideoStream:b}):"endCall"===n?u.a.createElement(Xi,{message:"You left the call",rejoinHandler:function(){r("callConfiguration")},homeHandler:function(){r("chat")}}):"end"===n?u.a.createElement(Kr,{rejoinHandler:function(){r("chat")},homeHandler:function(){return window.location.href=window.location.origin}}):"removedFromThread"===n?u.a.createElement(Jr,{homeHandler:function(){return window.location.href=window.location.origin}}):void 0)},ec=(n(1040),{componentStyles:{SvgIcon:c.a},componentVariables:{SvgIcon:o.a},siteVariables:s});m.a.render(u.a.createElement(r.a,{theme:Object(a.mergeThemes)(ec,i.a),className:"wrapper"},u.a.createElement("meta",{name:"viewport",content:"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"}),u.a.createElement(qi,null)),document.getElementById("root"))},151:function(e,t,n){e.exports=n.p+"static/media/staticmedia.3545b0ef.svg"},443:function(e,t,n){e.exports=n.p+"static/media/hero.8df54419.svg"},821:function(e,t,n){e.exports=n(1044)},833:function(e){e.exports=JSON.parse('{"name":"azure-communication-services-chat-sample","version":"0.1.0","private":true,"dependencies":{"@azure/communication-chat":"1.0.0","@azure/communication-common":"1.0.0","@azure/communication-signaling":"1.0.0-beta.3","@fluentui/react":"^7.166.2","@fluentui/react-icons-northstar":"^0.51.7","@fluentui/react-northstar":"^0.51.7","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.3.2","@testing-library/user-event":"^7.1.2","@types/preval.macro":"^3.0.0","@types/react-aria-live":"^2.0.0","preval.macro":"^5.0.0","react":"^16.14.0","react-aria-live":"^2.0.5","react-dom":"^16.14.0","react-redux":"^7.2.3","react-scripts":"^3.4.4","redux":"^4.0.5","redux-thunk":"^2.3.0"},"devDependencies":{"@types/react-redux":"^7.1.16","prettier":"2.1.0","typescript":"^3.9.9"},"scripts":{"setup":"npm i","start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","prettier":"prettier --write --config .prettierrc **/*.ts **/*.ts","prettier:check":"prettier --check --config .prettierrc **/*.ts **/*.ts","lint":"eslint -c package.json --ext ts --ext tsx ."},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')}},[[821,1,2]]]);
//# sourceMappingURL=main.52e20081.chunk.js.map